###
### Path Mode handling
###
[default language_features=NONE,+SQL_GRAPH,+SQL_GRAPH_ADVANCED_QUERY,+SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION,+SQL_GRAPH_PATH_MODE]
[default no_test_extract_table_names]
# No unparser due to SQLBuilder visitor not implemented for GraphMakeElement

# TRAIL path mode on top-level path.
select gt.* from
graph_table(aml
  MATCH TRAIL (a)-(b)-(c)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#6 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#6]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#6]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#6]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#6]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element1#2]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.b#3]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element2#4]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.c#5]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.c#5
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#6]
                    +-expr_list=
                    | +-the_answer#6 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5])
==

# WALK path mode on top-level path.
select gt.* from
graph_table(aml
  MATCH WALK (a)-(b)-(c)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#6 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#6]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#6]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#6]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#6]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element1#2]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.b#3]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element2#4]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.c#5]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.c#5
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=WALK)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#6]
                    +-expr_list=
                    | +-the_answer#6 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5])
==

# SIMPLE path mode on top-level path.
select gt.* from
graph_table(aml
  MATCH SIMPLE (a)-(b)-(c)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#6 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#6]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#6]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#6]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#6]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element1#2]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.b#3]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element2#4]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.c#5]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.c#5
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=SIMPLE)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#6]
                    +-expr_list=
                    | +-the_answer#6 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5])
==

# ACYCLIC path mode on top-level path.
select gt.* from
graph_table(aml
  MATCH ACYCLIC (a)-(b)-(c)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#6 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#6]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#6]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#6]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#6]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element1#2]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.b#3]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element2#4]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.c#5]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.c#5
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=ACYCLIC)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#6]
                    +-expr_list=
                    | +-the_answer#6 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5])
==

# TRAIL path mode does not apply to whole graph pattern.
select gt.* from
graph_table(aml
  MATCH TRAIL (a)-(b)-(c), (b)-(c)-(d)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#11 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#11]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#11]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#11]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#11]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5, b#6, $element3#7, c#8, $element4#9, d#10]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | | | +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | | | +-input_scan_list=
                  | | | | +-GraphNodeScan
                  | | | | | +-column_list=[$element_table.a#1]
                  | | | | | +-label_expr=
                  | | | | | | +-GraphLabelNaryExpr
                  | | | | | |   +-op=OR
                  | | | | | |   +-operand_list=
                  | | | | | |     +-GraphWildCardLabel
                  | | | | | |     +-GraphLabelNaryExpr
                  | | | | | |       +-op=NOT
                  | | | | | |       +-operand_list=
                  | | | | | |         +-GraphWildCardLabel
                  | | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | | | | +-GraphEdgeScan
                  | | | | | +-column_list=[$element_table.$element1#2]
                  | | | | | +-label_expr=
                  | | | | | | +-GraphLabelNaryExpr
                  | | | | | |   +-op=OR
                  | | | | | |   +-operand_list=
                  | | | | | |     +-GraphWildCardLabel
                  | | | | | |     +-GraphLabelNaryExpr
                  | | | | | |       +-op=NOT
                  | | | | | |       +-operand_list=
                  | | | | | |         +-GraphWildCardLabel
                  | | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | | | | | +-orientation=ANY
                  | | | | +-GraphNodeScan
                  | | | | | +-column_list=[$element_table.b#3]
                  | | | | | +-label_expr=
                  | | | | | | +-GraphLabelNaryExpr
                  | | | | | |   +-op=AND
                  | | | | | |   +-operand_list=
                  | | | | | |     +-GraphLabelNaryExpr
                  | | | | | |     | +-op=OR
                  | | | | | |     | +-operand_list=
                  | | | | | |     |   +-GraphWildCardLabel
                  | | | | | |     |   +-GraphLabelNaryExpr
                  | | | | | |     |     +-op=NOT
                  | | | | | |     |     +-operand_list=
                  | | | | | |     |       +-GraphWildCardLabel
                  | | | | | |     +-GraphLabelNaryExpr
                  | | | | | |       +-op=OR
                  | | | | | |       +-operand_list=
                  | | | | | |         +-GraphWildCardLabel
                  | | | | | |         +-GraphLabelNaryExpr
                  | | | | | |           +-op=NOT
                  | | | | | |           +-operand_list=
                  | | | | | |             +-GraphWildCardLabel
                  | | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | | | | +-GraphEdgeScan
                  | | | | | +-column_list=[$element_table.$element2#4]
                  | | | | | +-label_expr=
                  | | | | | | +-GraphLabelNaryExpr
                  | | | | | |   +-op=OR
                  | | | | | |   +-operand_list=
                  | | | | | |     +-GraphWildCardLabel
                  | | | | | |     +-GraphLabelNaryExpr
                  | | | | | |       +-op=NOT
                  | | | | | |       +-operand_list=
                  | | | | | |         +-GraphWildCardLabel
                  | | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | | | | | +-orientation=ANY
                  | | | | +-GraphNodeScan
                  | | | |   +-column_list=[$element_table.c#5]
                  | | | |   +-label_expr=
                  | | | |   | +-GraphLabelNaryExpr
                  | | | |   |   +-op=AND
                  | | | |   |   +-operand_list=
                  | | | |   |     +-GraphLabelNaryExpr
                  | | | |   |     | +-op=OR
                  | | | |   |     | +-operand_list=
                  | | | |   |     |   +-GraphWildCardLabel
                  | | | |   |     |   +-GraphLabelNaryExpr
                  | | | |   |     |     +-op=NOT
                  | | | |   |     |     +-operand_list=
                  | | | |   |     |       +-GraphWildCardLabel
                  | | | |   |     +-GraphLabelNaryExpr
                  | | | |   |       +-op=OR
                  | | | |   |       +-operand_list=
                  | | | |   |         +-GraphWildCardLabel
                  | | | |   |         +-GraphLabelNaryExpr
                  | | | |   |           +-op=NOT
                  | | | |   |           +-operand_list=
                  | | | |   |             +-GraphWildCardLabel
                  | | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | | | +-head=$element_table.a#1
                  | | | +-tail=$element_table.c#5
                  | | | +-path_mode=
                  | | |   +-GraphPathMode(path_mode=TRAIL)
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[b#6, $element3#7, c#8, $element4#9, d#10]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.b#6]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=AND
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |     | +-op=OR
                  | |   | | |     | +-operand_list=
                  | |   | | |     |   +-GraphWildCardLabel
                  | |   | | |     |   +-GraphLabelNaryExpr
                  | |   | | |     |     +-op=NOT
                  | |   | | |     |     +-operand_list=
                  | |   | | |     |       +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=OR
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | |         +-GraphLabelNaryExpr
                  | |   | | |           +-op=NOT
                  | |   | | |           +-operand_list=
                  | |   | | |             +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element3#7]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.c#8]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=AND
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |     | +-op=OR
                  | |   | | |     | +-operand_list=
                  | |   | | |     |   +-GraphWildCardLabel
                  | |   | | |     |   +-GraphLabelNaryExpr
                  | |   | | |     |     +-op=NOT
                  | |   | | |     |     +-operand_list=
                  | |   | | |     |       +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=OR
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | |         +-GraphLabelNaryExpr
                  | |   | | |           +-op=NOT
                  | |   | | |           +-operand_list=
                  | |   | | |             +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element4#9]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.d#10]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.b#6
                  | |   +-tail=$element_table.d#10
                  | +-filter_expr=
                  | | +-FunctionCall(ZetaSQL:$and(BOOL, repeated(1) BOOL) -> BOOL)
                  | |   +-FunctionCall(ZetaSQL:$equal(GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>) -> BOOL)
                  | |   | +-ColumnRef(type=GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, column=$element_table.b#3)
                  | |   | +-ColumnRef(type=GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, column=$element_table.b#6)
                  | |   +-FunctionCall(ZetaSQL:$equal(GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>) -> BOOL)
                  | |     +-ColumnRef(type=GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, column=$element_table.c#5)
                  | |     +-ColumnRef(type=GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, column=$element_table.c#8)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#11]
                    +-expr_list=
                    | +-the_answer#11 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5, $element3#7, $element4#9, d#10])
==

# TRAIL path mode works with quantified paths.
select gt.* from
graph_table(aml
  MATCH TRAIL (a)-[e]-{1,3}(b)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#11 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#11]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#11]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#11]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#11]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$element_table.a#1, $path_scan.$head#8, $element_table.e#6, $path_scan.$tail#9, $element_table.b#10]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$element_table.a#1, $path_scan.$head#8, $element_table.e#6, $path_scan.$tail#9, $element_table.b#10]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=[$path_scan.$head#8, $element_table.e#6, $path_scan.$tail#9]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element1#2]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e#3]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | | | +-orientation=ANY
                  | |   | | | +-GraphNodeScan
                  | |   | | |   +-column_list=[$element_table.$element2#4]
                  | |   | | |   +-label_expr=
                  | |   | | |   | +-GraphLabelNaryExpr
                  | |   | | |   |   +-op=OR
                  | |   | | |   |   +-operand_list=
                  | |   | | |   |     +-GraphWildCardLabel
                  | |   | | |   |     +-GraphLabelNaryExpr
                  | |   | | |   |       +-op=NOT
                  | |   | | |   |       +-operand_list=
                  | |   | | |   |         +-GraphWildCardLabel
                  | |   | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | +-head=$path_scan.$head#8
                  | |   | | +-tail=$path_scan.$tail#9
                  | |   | | +-quantifier=
                  | |   | | | +-GraphPathPatternQuantifier
                  | |   | | |   +-lower_bound=
                  | |   | | |   | +-Literal(type=INT64, value=1)
                  | |   | | |   +-upper_bound=
                  | |   | | |     +-Literal(type=INT64, value=3)
                  | |   | | +-group_variable_list=
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element1#2, array=$element_table.$element1#5)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.e#3, array=$element_table.e#6)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element2#4, array=$element_table.$element2#7)
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.b#10]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.b#10
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#11]
                    +-expr_list=
                    | +-the_answer#11 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, e#6, b#10])
==

# ACYCLIC path mode works with quantified paths.
select gt.* from
graph_table(aml
  MATCH ACYCLIC (a)-[e]-{1,3}(b)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#11 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#11]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#11]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#11]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#11]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$element_table.a#1, $path_scan.$head#8, $element_table.$element1#5, $element_table.$element2#7, $path_scan.$tail#9, $element_table.b#10]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$element_table.a#1, $path_scan.$head#8, $element_table.$element1#5, $element_table.$element2#7, $path_scan.$tail#9, $element_table.b#10]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=[$path_scan.$head#8, $element_table.$element1#5, $element_table.$element2#7, $path_scan.$tail#9]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element1#2]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e#3]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | | | +-orientation=ANY
                  | |   | | | +-GraphNodeScan
                  | |   | | |   +-column_list=[$element_table.$element2#4]
                  | |   | | |   +-label_expr=
                  | |   | | |   | +-GraphLabelNaryExpr
                  | |   | | |   |   +-op=OR
                  | |   | | |   |   +-operand_list=
                  | |   | | |   |     +-GraphWildCardLabel
                  | |   | | |   |     +-GraphLabelNaryExpr
                  | |   | | |   |       +-op=NOT
                  | |   | | |   |       +-operand_list=
                  | |   | | |   |         +-GraphWildCardLabel
                  | |   | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | +-head=$path_scan.$head#8
                  | |   | | +-tail=$path_scan.$tail#9
                  | |   | | +-quantifier=
                  | |   | | | +-GraphPathPatternQuantifier
                  | |   | | |   +-lower_bound=
                  | |   | | |   | +-Literal(type=INT64, value=1)
                  | |   | | |   +-upper_bound=
                  | |   | | |     +-Literal(type=INT64, value=3)
                  | |   | | +-group_variable_list=
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element1#2, array=$element_table.$element1#5)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.e#3, array=$element_table.e#6)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element2#4, array=$element_table.$element2#7)
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.b#10]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.b#10
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=ACYCLIC)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#11]
                    +-expr_list=
                    | +-the_answer#11 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#5, $element2#7, b#10])
==

# Nested path modes work.
select gt.* from
graph_table(aml
  MATCH TRAIL (a)(SIMPLE -[e]-)(c)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#6 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#6]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#6]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#6]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#6]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[a#1, $element1#2, e#3, $element2#4, c#5]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[a#1, $element1#2, e#3, $element2#4, c#5]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=$element_table.[$element1#2, e#3, $element2#4]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element1#2]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e#3]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | | | +-orientation=ANY
                  | |   | | | +-GraphNodeScan
                  | |   | | |   +-column_list=[$element_table.$element2#4]
                  | |   | | |   +-label_expr=
                  | |   | | |   | +-GraphLabelNaryExpr
                  | |   | | |   |   +-op=OR
                  | |   | | |   |   +-operand_list=
                  | |   | | |   |     +-GraphWildCardLabel
                  | |   | | |   |     +-GraphLabelNaryExpr
                  | |   | | |   |       +-op=NOT
                  | |   | | |   |       +-operand_list=
                  | |   | | |   |         +-GraphWildCardLabel
                  | |   | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | +-head=$element_table.$element1#2
                  | |   | | +-tail=$element_table.$element2#4
                  | |   | | +-path_mode=
                  | |   | |   +-GraphPathMode(path_mode=SIMPLE)
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.c#5]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.c#5
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#6]
                    +-expr_list=
                    | +-the_answer#6 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, e#3, $element2#4, c#5])
==

# Nested path modes with quantified edges on a path work.
select gt.* from
graph_table(aml
  MATCH (a)(ACYCLIC -[e1]-(n1)-[e2]-{1,3})(b)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#14 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#14]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#14]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#14]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#14]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$element_table.a#1, $element_table.$element1#2, $element_table.e1#3, $element_table.n1#4, $path_scan.$head#11, $element_table.$element2#8, $element_table.$element3#10, $path_scan.$tail#12, $element_table.b#13]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$element_table.a#1, $element_table.$element1#2, $element_table.e1#3, $element_table.n1#4, $path_scan.$head#11, $element_table.$element2#8, $element_table.$element3#10, $path_scan.$tail#12, $element_table.b#13]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=[$element_table.$element1#2, $element_table.e1#3, $element_table.n1#4, $path_scan.$head#11, $element_table.$element2#8, $element_table.$element3#10, $path_scan.$tail#12]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element1#2]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e1#3]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | | | +-orientation=ANY
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.n1#4]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphPathScan
                  | |   | | |   +-column_list=[$path_scan.$head#11, $element_table.$element2#8, $element_table.$element3#10, $path_scan.$tail#12]
                  | |   | | |   +-input_scan_list=
                  | |   | | |   | +-GraphNodeScan
                  | |   | | |   | | +-column_list=[$element_table.$element2#5]
                  | |   | | |   | | +-label_expr=
                  | |   | | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   | | |   +-op=OR
                  | |   | | |   | | |   +-operand_list=
                  | |   | | |   | | |     +-GraphWildCardLabel
                  | |   | | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |   | | |       +-op=NOT
                  | |   | | |   | | |       +-operand_list=
                  | |   | | |   | | |         +-GraphWildCardLabel
                  | |   | | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | |   | +-GraphEdgeScan
                  | |   | | |   | | +-column_list=[$element_table.e2#6]
                  | |   | | |   | | +-label_expr=
                  | |   | | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   | | |   +-op=OR
                  | |   | | |   | | |   +-operand_list=
                  | |   | | |   | | |     +-GraphWildCardLabel
                  | |   | | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |   | | |       +-op=NOT
                  | |   | | |   | | |       +-operand_list=
                  | |   | | |   | | |         +-GraphWildCardLabel
                  | |   | | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | |   | | +-orientation=ANY
                  | |   | | |   | +-GraphNodeScan
                  | |   | | |   |   +-column_list=[$element_table.$element3#7]
                  | |   | | |   |   +-label_expr=
                  | |   | | |   |   | +-GraphLabelNaryExpr
                  | |   | | |   |   |   +-op=OR
                  | |   | | |   |   |   +-operand_list=
                  | |   | | |   |   |     +-GraphWildCardLabel
                  | |   | | |   |   |     +-GraphLabelNaryExpr
                  | |   | | |   |   |       +-op=NOT
                  | |   | | |   |   |       +-operand_list=
                  | |   | | |   |   |         +-GraphWildCardLabel
                  | |   | | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | |   +-head=$path_scan.$head#11
                  | |   | | |   +-tail=$path_scan.$tail#12
                  | |   | | |   +-quantifier=
                  | |   | | |   | +-GraphPathPatternQuantifier
                  | |   | | |   |   +-lower_bound=
                  | |   | | |   |   | +-Literal(type=INT64, value=1)
                  | |   | | |   |   +-upper_bound=
                  | |   | | |   |     +-Literal(type=INT64, value=3)
                  | |   | | |   +-group_variable_list=
                  | |   | | |     +-GraphMakeArrayVariable(element=$element_table.$element2#5, array=$element_table.$element2#8)
                  | |   | | |     +-GraphMakeArrayVariable(element=$element_table.e2#6, array=$element_table.e2#9)
                  | |   | | |     +-GraphMakeArrayVariable(element=$element_table.$element3#7, array=$element_table.$element3#10)
                  | |   | | +-head=$element_table.$element1#2
                  | |   | | +-tail=$path_scan.$tail#12
                  | |   | | +-path_mode=
                  | |   | |   +-GraphPathMode(path_mode=ACYCLIC)
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.b#13]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.b#13
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#14]
                    +-expr_list=
                    | +-the_answer#14 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, e1#3, n1#4, $element2#8, $element3#10, b#13])
==

# TRAIL path mode works with paths created from quantified edges.
select gt.* from
graph_table(aml
  MATCH TRAIL (-[e]-{1,3} WHERE 20>10)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#9 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#9]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#9]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#9]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#9]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$path_scan.$head#7, $element_table.e#5, $path_scan.$tail#8]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$path_scan.$head#7, $element_table.e#5, $path_scan.$tail#8]
                  | |   +-input_scan_list=
                  | |   | +-GraphPathScan
                  | |   |   +-column_list=[$path_scan.$head#7, $element_table.e#5, $path_scan.$tail#8]
                  | |   |   +-input_scan_list=
                  | |   |   | +-GraphPathScan
                  | |   |   |   +-column_list=[$path_scan.$head#7, $element_table.e#5, $path_scan.$tail#8]
                  | |   |   |   +-input_scan_list=
                  | |   |   |   | +-GraphNodeScan
                  | |   |   |   | | +-column_list=[$element_table.$element1#1]
                  | |   |   |   | | +-label_expr=
                  | |   |   |   | | | +-GraphLabelNaryExpr
                  | |   |   |   | | |   +-op=OR
                  | |   |   |   | | |   +-operand_list=
                  | |   |   |   | | |     +-GraphWildCardLabel
                  | |   |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   |   | | |       +-op=NOT
                  | |   |   |   | | |       +-operand_list=
                  | |   |   |   | | |         +-GraphWildCardLabel
                  | |   |   |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   |   | +-GraphEdgeScan
                  | |   |   |   | | +-column_list=[$element_table.e#2]
                  | |   |   |   | | +-label_expr=
                  | |   |   |   | | | +-GraphLabelNaryExpr
                  | |   |   |   | | |   +-op=OR
                  | |   |   |   | | |   +-operand_list=
                  | |   |   |   | | |     +-GraphWildCardLabel
                  | |   |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   |   | | |       +-op=NOT
                  | |   |   |   | | |       +-operand_list=
                  | |   |   |   | | |         +-GraphWildCardLabel
                  | |   |   |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   |   |   | | +-orientation=ANY
                  | |   |   |   | +-GraphNodeScan
                  | |   |   |   |   +-column_list=[$element_table.$element2#3]
                  | |   |   |   |   +-label_expr=
                  | |   |   |   |   | +-GraphLabelNaryExpr
                  | |   |   |   |   |   +-op=OR
                  | |   |   |   |   |   +-operand_list=
                  | |   |   |   |   |     +-GraphWildCardLabel
                  | |   |   |   |   |     +-GraphLabelNaryExpr
                  | |   |   |   |   |       +-op=NOT
                  | |   |   |   |   |       +-operand_list=
                  | |   |   |   |   |         +-GraphWildCardLabel
                  | |   |   |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   |   +-head=$path_scan.$head#7
                  | |   |   |   +-tail=$path_scan.$tail#8
                  | |   |   |   +-quantifier=
                  | |   |   |   | +-GraphPathPatternQuantifier
                  | |   |   |   |   +-lower_bound=
                  | |   |   |   |   | +-Literal(type=INT64, value=1)
                  | |   |   |   |   +-upper_bound=
                  | |   |   |   |     +-Literal(type=INT64, value=3)
                  | |   |   |   +-group_variable_list=
                  | |   |   |     +-GraphMakeArrayVariable(element=$element_table.$element1#1, array=$element_table.$element1#4)
                  | |   |   |     +-GraphMakeArrayVariable(element=$element_table.e#2, array=$element_table.e#5)
                  | |   |   |     +-GraphMakeArrayVariable(element=$element_table.$element2#3, array=$element_table.$element2#6)
                  | |   |   +-filter_expr=
                  | |   |   | +-FunctionCall(ZetaSQL:$greater(INT64, INT64) -> BOOL)
                  | |   |   |   +-Literal(type=INT64, value=20)
                  | |   |   |   +-Literal(type=INT64, value=10)
                  | |   |   +-head=$path_scan.$head#7
                  | |   |   +-tail=$path_scan.$tail#8
                  | |   +-head=$path_scan.$head#7
                  | |   +-tail=$path_scan.$tail#8
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#9]
                    +-expr_list=
                    | +-the_answer#9 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=[$element_table.e#5])
==

# Path modes work with paths that have ASTGraphPathPattern nodes stripped.
select gt.* from
graph_table(aml
  MATCH TRAIL (ACYCLIC -)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#4 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#4]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#4]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#4]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#4]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[$element1#1, $element2#2, $element3#3]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[$element1#1, $element2#2, $element3#3]
                  | |   +-input_scan_list=
                  | |   | +-GraphPathScan
                  | |   |   +-column_list=$element_table.[$element1#1, $element2#2, $element3#3]
                  | |   |   +-input_scan_list=
                  | |   |   | +-GraphNodeScan
                  | |   |   | | +-column_list=[$element_table.$element1#1]
                  | |   |   | | +-label_expr=
                  | |   |   | | | +-GraphLabelNaryExpr
                  | |   |   | | |   +-op=OR
                  | |   |   | | |   +-operand_list=
                  | |   |   | | |     +-GraphWildCardLabel
                  | |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   | | |       +-op=NOT
                  | |   |   | | |       +-operand_list=
                  | |   |   | | |         +-GraphWildCardLabel
                  | |   |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   | +-GraphEdgeScan
                  | |   |   | | +-column_list=[$element_table.$element2#2]
                  | |   |   | | +-label_expr=
                  | |   |   | | | +-GraphLabelNaryExpr
                  | |   |   | | |   +-op=OR
                  | |   |   | | |   +-operand_list=
                  | |   |   | | |     +-GraphWildCardLabel
                  | |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   | | |       +-op=NOT
                  | |   |   | | |       +-operand_list=
                  | |   |   | | |         +-GraphWildCardLabel
                  | |   |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   |   | | +-orientation=ANY
                  | |   |   | +-GraphNodeScan
                  | |   |   |   +-column_list=[$element_table.$element3#3]
                  | |   |   |   +-label_expr=
                  | |   |   |   | +-GraphLabelNaryExpr
                  | |   |   |   |   +-op=OR
                  | |   |   |   |   +-operand_list=
                  | |   |   |   |     +-GraphWildCardLabel
                  | |   |   |   |     +-GraphLabelNaryExpr
                  | |   |   |   |       +-op=NOT
                  | |   |   |   |       +-operand_list=
                  | |   |   |   |         +-GraphWildCardLabel
                  | |   |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   +-head=$element_table.$element1#1
                  | |   |   +-tail=$element_table.$element3#3
                  | |   |   +-path_mode=
                  | |   |     +-GraphPathMode(path_mode=ACYCLIC)
                  | |   +-head=$element_table.$element1#1
                  | |   +-tail=$element_table.$element3#3
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#4]
                    +-expr_list=
                    | +-the_answer#4 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[$element1#1, $element2#2, $element3#3])
==

# Path modes work with quantified paths that have been converted from quantified
# edge patterns.
select gt.* from
graph_table(aml
  MATCH TRAIL -{5}
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#9 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#9]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#9]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#9]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#9]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$path_scan.$head#7, $element_table.$element2#5, $path_scan.$tail#8]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$path_scan.$head#7, $element_table.$element2#5, $path_scan.$tail#8]
                  | |   +-input_scan_list=
                  | |   | +-GraphPathScan
                  | |   |   +-column_list=[$path_scan.$head#7, $element_table.$element2#5, $path_scan.$tail#8]
                  | |   |   +-input_scan_list=
                  | |   |   | +-GraphNodeScan
                  | |   |   | | +-column_list=[$element_table.$element1#1]
                  | |   |   | | +-label_expr=
                  | |   |   | | | +-GraphLabelNaryExpr
                  | |   |   | | |   +-op=OR
                  | |   |   | | |   +-operand_list=
                  | |   |   | | |     +-GraphWildCardLabel
                  | |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   | | |       +-op=NOT
                  | |   |   | | |       +-operand_list=
                  | |   |   | | |         +-GraphWildCardLabel
                  | |   |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   | +-GraphEdgeScan
                  | |   |   | | +-column_list=[$element_table.$element2#2]
                  | |   |   | | +-label_expr=
                  | |   |   | | | +-GraphLabelNaryExpr
                  | |   |   | | |   +-op=OR
                  | |   |   | | |   +-operand_list=
                  | |   |   | | |     +-GraphWildCardLabel
                  | |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   | | |       +-op=NOT
                  | |   |   | | |       +-operand_list=
                  | |   |   | | |         +-GraphWildCardLabel
                  | |   |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   |   | | +-orientation=ANY
                  | |   |   | +-GraphNodeScan
                  | |   |   |   +-column_list=[$element_table.$element3#3]
                  | |   |   |   +-label_expr=
                  | |   |   |   | +-GraphLabelNaryExpr
                  | |   |   |   |   +-op=OR
                  | |   |   |   |   +-operand_list=
                  | |   |   |   |     +-GraphWildCardLabel
                  | |   |   |   |     +-GraphLabelNaryExpr
                  | |   |   |   |       +-op=NOT
                  | |   |   |   |       +-operand_list=
                  | |   |   |   |         +-GraphWildCardLabel
                  | |   |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   +-head=$path_scan.$head#7
                  | |   |   +-tail=$path_scan.$tail#8
                  | |   |   +-quantifier=
                  | |   |   | +-GraphPathPatternQuantifier
                  | |   |   |   +-lower_bound=
                  | |   |   |   | +-Literal(type=INT64, value=5)
                  | |   |   |   +-upper_bound=
                  | |   |   |     +-Literal(type=INT64, value=5)
                  | |   |   +-group_variable_list=
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.$element1#1, array=$element_table.$element1#4)
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.$element2#2, array=$element_table.$element2#5)
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.$element3#3, array=$element_table.$element3#6)
                  | |   +-head=$path_scan.$head#7
                  | |   +-tail=$path_scan.$tail#8
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#9]
                    +-expr_list=
                    | +-the_answer#9 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=[$element_table.$element2#5])
==

# Nested path modes work with quantified paths that have been converted from
# quantified edge patterns.
select gt.* from
graph_table(aml
  MATCH TRAIL (SIMPLE -{5})
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#9 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#9]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#9]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#9]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#9]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$path_scan.$head#7, $element_table.$element1#4, $element_table.$element2#5, $element_table.$element3#6, $path_scan.$tail#8]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$path_scan.$head#7, $element_table.$element1#4, $element_table.$element2#5, $element_table.$element3#6, $path_scan.$tail#8]
                  | |   +-input_scan_list=
                  | |   | +-GraphPathScan
                  | |   |   +-column_list=[$path_scan.$head#7, $element_table.$element1#4, $element_table.$element2#5, $element_table.$element3#6, $path_scan.$tail#8]
                  | |   |   +-input_scan_list=
                  | |   |   | +-GraphPathScan
                  | |   |   |   +-column_list=[$path_scan.$head#7, $element_table.$element1#4, $element_table.$element2#5, $element_table.$element3#6, $path_scan.$tail#8]
                  | |   |   |   +-input_scan_list=
                  | |   |   |   | +-GraphNodeScan
                  | |   |   |   | | +-column_list=[$element_table.$element1#1]
                  | |   |   |   | | +-label_expr=
                  | |   |   |   | | | +-GraphLabelNaryExpr
                  | |   |   |   | | |   +-op=OR
                  | |   |   |   | | |   +-operand_list=
                  | |   |   |   | | |     +-GraphWildCardLabel
                  | |   |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   |   | | |       +-op=NOT
                  | |   |   |   | | |       +-operand_list=
                  | |   |   |   | | |         +-GraphWildCardLabel
                  | |   |   |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   |   | +-GraphEdgeScan
                  | |   |   |   | | +-column_list=[$element_table.$element2#2]
                  | |   |   |   | | +-label_expr=
                  | |   |   |   | | | +-GraphLabelNaryExpr
                  | |   |   |   | | |   +-op=OR
                  | |   |   |   | | |   +-operand_list=
                  | |   |   |   | | |     +-GraphWildCardLabel
                  | |   |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   |   | | |       +-op=NOT
                  | |   |   |   | | |       +-operand_list=
                  | |   |   |   | | |         +-GraphWildCardLabel
                  | |   |   |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   |   |   | | +-orientation=ANY
                  | |   |   |   | +-GraphNodeScan
                  | |   |   |   |   +-column_list=[$element_table.$element3#3]
                  | |   |   |   |   +-label_expr=
                  | |   |   |   |   | +-GraphLabelNaryExpr
                  | |   |   |   |   |   +-op=OR
                  | |   |   |   |   |   +-operand_list=
                  | |   |   |   |   |     +-GraphWildCardLabel
                  | |   |   |   |   |     +-GraphLabelNaryExpr
                  | |   |   |   |   |       +-op=NOT
                  | |   |   |   |   |       +-operand_list=
                  | |   |   |   |   |         +-GraphWildCardLabel
                  | |   |   |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   |   +-head=$path_scan.$head#7
                  | |   |   |   +-tail=$path_scan.$tail#8
                  | |   |   |   +-quantifier=
                  | |   |   |   | +-GraphPathPatternQuantifier
                  | |   |   |   |   +-lower_bound=
                  | |   |   |   |   | +-Literal(type=INT64, value=5)
                  | |   |   |   |   +-upper_bound=
                  | |   |   |   |     +-Literal(type=INT64, value=5)
                  | |   |   |   +-group_variable_list=
                  | |   |   |     +-GraphMakeArrayVariable(element=$element_table.$element1#1, array=$element_table.$element1#4)
                  | |   |   |     +-GraphMakeArrayVariable(element=$element_table.$element2#2, array=$element_table.$element2#5)
                  | |   |   |     +-GraphMakeArrayVariable(element=$element_table.$element3#3, array=$element_table.$element3#6)
                  | |   |   +-head=$path_scan.$head#7
                  | |   |   +-tail=$path_scan.$tail#8
                  | |   |   +-path_mode=
                  | |   |     +-GraphPathMode(path_mode=SIMPLE)
                  | |   +-head=$path_scan.$head#7
                  | |   +-tail=$path_scan.$tail#8
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#9]
                    +-expr_list=
                    | +-the_answer#9 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[$element1#4, $element2#5, $element3#6])
==

###
### Path Mode handling SQLBuilder tests
###

[default language_features=NONE,+SQL_GRAPH,+SQL_GRAPH_ADVANCED_QUERY,+SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION,+SQL_GRAPH_PATH_MODE]
[default no_test_extract_table_names]
[default run_sqlbuilder]
[default show_sqlbuilder_output]

# TRAIL path mode on top-level path.
select gt.* from
graph_table(aml
  MATCH TRAIL (a)-(b)-(c)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#6 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#6]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#6]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#6]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#6]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element1#2]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.b#3]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element2#4]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.c#5]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.c#5
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#6]
                    +-expr_list=
                    | +-the_answer#6 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5])

[SQLBUILDER_TARGET_SYNTAX_MODE standard]
[SQLBUILDER_OUTPUT]
SELECT
  aml_1.a_7 AS the_answer
FROM
  GRAPH_TABLE(
    aml
    MATCH
      TRAIL
      (a_2
      IS (% | ! %))
      -[a_3
      IS (% | ! %)]-
      (a_4
      IS (% | ! %))
      -[a_5
      IS (% | ! %)]-
      (a_6
      IS (% | ! %))
    RETURN
      42 AS a_7
  ) AS aml_1;

[SQLBUILDER_TARGET_SYNTAX_MODE pipe]
[SQLBUILDER_OUTPUT]
FROM
  GRAPH_TABLE(
    aml
    MATCH
      TRAIL
      (a_2
      IS (% | ! %))
      -[a_3
      IS (% | ! %)]-
      (a_4
      IS (% | ! %))
      -[a_5
      IS (% | ! %)]-
      (a_6
      IS (% | ! %))
    RETURN
      42 AS a_7
  ) AS aml_1
|> SELECT
     aml_1.a_7 AS the_answer;
==

# WALK path mode on top-level path.
select gt.* from
graph_table(aml
  MATCH WALK (a)-(b)-(c)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#6 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#6]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#6]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#6]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#6]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element1#2]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.b#3]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element2#4]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.c#5]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.c#5
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=WALK)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#6]
                    +-expr_list=
                    | +-the_answer#6 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5])

[SQLBUILDER_TARGET_SYNTAX_MODE standard]
[SQLBUILDER_OUTPUT]
SELECT
  aml_1.a_7 AS the_answer
FROM
  GRAPH_TABLE(
    aml
    MATCH
      WALK
      (a_2
      IS (% | ! %))
      -[a_3
      IS (% | ! %)]-
      (a_4
      IS (% | ! %))
      -[a_5
      IS (% | ! %)]-
      (a_6
      IS (% | ! %))
    RETURN
      42 AS a_7
  ) AS aml_1;

[SQLBUILDER_TARGET_SYNTAX_MODE pipe]
[SQLBUILDER_OUTPUT]
FROM
  GRAPH_TABLE(
    aml
    MATCH
      WALK
      (a_2
      IS (% | ! %))
      -[a_3
      IS (% | ! %)]-
      (a_4
      IS (% | ! %))
      -[a_5
      IS (% | ! %)]-
      (a_6
      IS (% | ! %))
    RETURN
      42 AS a_7
  ) AS aml_1
|> SELECT
     aml_1.a_7 AS the_answer;
==

# SIMPLE path mode on top-level path.
select gt.* from
graph_table(aml
  MATCH SIMPLE (a)-(b)-(c)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#6 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#6]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#6]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#6]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#6]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element1#2]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.b#3]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element2#4]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.c#5]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.c#5
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=SIMPLE)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#6]
                    +-expr_list=
                    | +-the_answer#6 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5])

[SQLBUILDER_TARGET_SYNTAX_MODE standard]
[SQLBUILDER_OUTPUT]
SELECT
  aml_1.a_7 AS the_answer
FROM
  GRAPH_TABLE(
    aml
    MATCH
      SIMPLE
      (a_2
      IS (% | ! %))
      -[a_3
      IS (% | ! %)]-
      (a_4
      IS (% | ! %))
      -[a_5
      IS (% | ! %)]-
      (a_6
      IS (% | ! %))
    RETURN
      42 AS a_7
  ) AS aml_1;

[SQLBUILDER_TARGET_SYNTAX_MODE pipe]
[SQLBUILDER_OUTPUT]
FROM
  GRAPH_TABLE(
    aml
    MATCH
      SIMPLE
      (a_2
      IS (% | ! %))
      -[a_3
      IS (% | ! %)]-
      (a_4
      IS (% | ! %))
      -[a_5
      IS (% | ! %)]-
      (a_6
      IS (% | ! %))
    RETURN
      42 AS a_7
  ) AS aml_1
|> SELECT
     aml_1.a_7 AS the_answer;
==

# ACYCLIC path mode on top-level path.
select gt.* from
graph_table(aml
  MATCH ACYCLIC (a)-(b)-(c)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#6 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#6]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#6]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#6]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#6]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element1#2]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.b#3]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element2#4]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.c#5]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.c#5
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=ACYCLIC)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#6]
                    +-expr_list=
                    | +-the_answer#6 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5])

[SQLBUILDER_TARGET_SYNTAX_MODE standard]
[SQLBUILDER_OUTPUT]
SELECT
  aml_1.a_7 AS the_answer
FROM
  GRAPH_TABLE(
    aml
    MATCH
      ACYCLIC
      (a_2
      IS (% | ! %))
      -[a_3
      IS (% | ! %)]-
      (a_4
      IS (% | ! %))
      -[a_5
      IS (% | ! %)]-
      (a_6
      IS (% | ! %))
    RETURN
      42 AS a_7
  ) AS aml_1;

[SQLBUILDER_TARGET_SYNTAX_MODE pipe]
[SQLBUILDER_OUTPUT]
FROM
  GRAPH_TABLE(
    aml
    MATCH
      ACYCLIC
      (a_2
      IS (% | ! %))
      -[a_3
      IS (% | ! %)]-
      (a_4
      IS (% | ! %))
      -[a_5
      IS (% | ! %)]-
      (a_6
      IS (% | ! %))
    RETURN
      42 AS a_7
  ) AS aml_1
|> SELECT
     aml_1.a_7 AS the_answer;
==

# TRAIL path mode does not apply to whole graph pattern.
select gt.* from
graph_table(aml
  MATCH TRAIL (a)-(b)-(c), (b)-(c)-(d)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#11 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#11]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#11]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#11]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#11]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5, b#6, $element3#7, c#8, $element4#9, d#10]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | | | +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | | | +-input_scan_list=
                  | | | | +-GraphNodeScan
                  | | | | | +-column_list=[$element_table.a#1]
                  | | | | | +-label_expr=
                  | | | | | | +-GraphLabelNaryExpr
                  | | | | | |   +-op=OR
                  | | | | | |   +-operand_list=
                  | | | | | |     +-GraphWildCardLabel
                  | | | | | |     +-GraphLabelNaryExpr
                  | | | | | |       +-op=NOT
                  | | | | | |       +-operand_list=
                  | | | | | |         +-GraphWildCardLabel
                  | | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | | | | +-GraphEdgeScan
                  | | | | | +-column_list=[$element_table.$element1#2]
                  | | | | | +-label_expr=
                  | | | | | | +-GraphLabelNaryExpr
                  | | | | | |   +-op=OR
                  | | | | | |   +-operand_list=
                  | | | | | |     +-GraphWildCardLabel
                  | | | | | |     +-GraphLabelNaryExpr
                  | | | | | |       +-op=NOT
                  | | | | | |       +-operand_list=
                  | | | | | |         +-GraphWildCardLabel
                  | | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | | | | | +-orientation=ANY
                  | | | | +-GraphNodeScan
                  | | | | | +-column_list=[$element_table.b#3]
                  | | | | | +-label_expr=
                  | | | | | | +-GraphLabelNaryExpr
                  | | | | | |   +-op=AND
                  | | | | | |   +-operand_list=
                  | | | | | |     +-GraphLabelNaryExpr
                  | | | | | |     | +-op=OR
                  | | | | | |     | +-operand_list=
                  | | | | | |     |   +-GraphWildCardLabel
                  | | | | | |     |   +-GraphLabelNaryExpr
                  | | | | | |     |     +-op=NOT
                  | | | | | |     |     +-operand_list=
                  | | | | | |     |       +-GraphWildCardLabel
                  | | | | | |     +-GraphLabelNaryExpr
                  | | | | | |       +-op=OR
                  | | | | | |       +-operand_list=
                  | | | | | |         +-GraphWildCardLabel
                  | | | | | |         +-GraphLabelNaryExpr
                  | | | | | |           +-op=NOT
                  | | | | | |           +-operand_list=
                  | | | | | |             +-GraphWildCardLabel
                  | | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | | | | +-GraphEdgeScan
                  | | | | | +-column_list=[$element_table.$element2#4]
                  | | | | | +-label_expr=
                  | | | | | | +-GraphLabelNaryExpr
                  | | | | | |   +-op=OR
                  | | | | | |   +-operand_list=
                  | | | | | |     +-GraphWildCardLabel
                  | | | | | |     +-GraphLabelNaryExpr
                  | | | | | |       +-op=NOT
                  | | | | | |       +-operand_list=
                  | | | | | |         +-GraphWildCardLabel
                  | | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | | | | | +-orientation=ANY
                  | | | | +-GraphNodeScan
                  | | | |   +-column_list=[$element_table.c#5]
                  | | | |   +-label_expr=
                  | | | |   | +-GraphLabelNaryExpr
                  | | | |   |   +-op=AND
                  | | | |   |   +-operand_list=
                  | | | |   |     +-GraphLabelNaryExpr
                  | | | |   |     | +-op=OR
                  | | | |   |     | +-operand_list=
                  | | | |   |     |   +-GraphWildCardLabel
                  | | | |   |     |   +-GraphLabelNaryExpr
                  | | | |   |     |     +-op=NOT
                  | | | |   |     |     +-operand_list=
                  | | | |   |     |       +-GraphWildCardLabel
                  | | | |   |     +-GraphLabelNaryExpr
                  | | | |   |       +-op=OR
                  | | | |   |       +-operand_list=
                  | | | |   |         +-GraphWildCardLabel
                  | | | |   |         +-GraphLabelNaryExpr
                  | | | |   |           +-op=NOT
                  | | | |   |           +-operand_list=
                  | | | |   |             +-GraphWildCardLabel
                  | | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | | | +-head=$element_table.a#1
                  | | | +-tail=$element_table.c#5
                  | | | +-path_mode=
                  | | |   +-GraphPathMode(path_mode=TRAIL)
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[b#6, $element3#7, c#8, $element4#9, d#10]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.b#6]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=AND
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |     | +-op=OR
                  | |   | | |     | +-operand_list=
                  | |   | | |     |   +-GraphWildCardLabel
                  | |   | | |     |   +-GraphLabelNaryExpr
                  | |   | | |     |     +-op=NOT
                  | |   | | |     |     +-operand_list=
                  | |   | | |     |       +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=OR
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | |         +-GraphLabelNaryExpr
                  | |   | | |           +-op=NOT
                  | |   | | |           +-operand_list=
                  | |   | | |             +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element3#7]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.c#8]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=AND
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |     | +-op=OR
                  | |   | | |     | +-operand_list=
                  | |   | | |     |   +-GraphWildCardLabel
                  | |   | | |     |   +-GraphLabelNaryExpr
                  | |   | | |     |     +-op=NOT
                  | |   | | |     |     +-operand_list=
                  | |   | | |     |       +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=OR
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | |         +-GraphLabelNaryExpr
                  | |   | | |           +-op=NOT
                  | |   | | |           +-operand_list=
                  | |   | | |             +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element4#9]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.d#10]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.b#6
                  | |   +-tail=$element_table.d#10
                  | +-filter_expr=
                  | | +-FunctionCall(ZetaSQL:$and(BOOL, repeated(1) BOOL) -> BOOL)
                  | |   +-FunctionCall(ZetaSQL:$equal(GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>) -> BOOL)
                  | |   | +-ColumnRef(type=GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, column=$element_table.b#3)
                  | |   | +-ColumnRef(type=GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, column=$element_table.b#6)
                  | |   +-FunctionCall(ZetaSQL:$equal(GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>) -> BOOL)
                  | |     +-ColumnRef(type=GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, column=$element_table.c#5)
                  | |     +-ColumnRef(type=GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, column=$element_table.c#8)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#11]
                    +-expr_list=
                    | +-the_answer#11 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5, $element3#7, $element4#9, d#10])

[SQLBUILDER_TARGET_SYNTAX_MODE standard]
[SQLBUILDER_OUTPUT]
SELECT
  aml_1.a_12 AS the_answer
FROM
  GRAPH_TABLE(
    aml
    MATCH
      TRAIL
      (a_2
      IS (% | ! %))
      -[a_3
      IS (% | ! %)]-
      (a_4
      IS ((% | ! %) &(% | ! %)))
      -[a_5
      IS (% | ! %)]-
      (a_6
      IS ((% | ! %) &(% | ! %))),
      (a_7
      IS ((% | ! %) &(% | ! %)))
      -[a_8
      IS (% | ! %)]-
      (a_9
      IS ((% | ! %) &(% | ! %)))
      -[a_10
      IS (% | ! %)]-
      (a_11
      IS (% | ! %))
      WHERE
        (a_4 = a_7) AND (a_6 = a_9)
    RETURN
      42 AS a_12
  ) AS aml_1;

[SQLBUILDER_TARGET_SYNTAX_MODE pipe]
[SQLBUILDER_OUTPUT]
FROM
  GRAPH_TABLE(
    aml
    MATCH
      TRAIL
      (a_2
      IS (% | ! %))
      -[a_3
      IS (% | ! %)]-
      (a_4
      IS ((% | ! %) &(% | ! %)))
      -[a_5
      IS (% | ! %)]-
      (a_6
      IS ((% | ! %) &(% | ! %))),
      (a_7
      IS ((% | ! %) &(% | ! %)))
      -[a_8
      IS (% | ! %)]-
      (a_9
      IS ((% | ! %) &(% | ! %)))
      -[a_10
      IS (% | ! %)]-
      (a_11
      IS (% | ! %))
      WHERE
        (a_4 = a_7) AND (a_6 = a_9)
    RETURN
      42 AS a_12
  ) AS aml_1
|> SELECT
     aml_1.a_12 AS the_answer;
==

# TRAIL path mode works with quantified paths.
select gt.* from
graph_table(aml
  MATCH TRAIL (a)-[e]-{1,3}(b)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#11 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#11]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#11]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#11]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#11]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$element_table.a#1, $path_scan.$head#8, $element_table.e#6, $path_scan.$tail#9, $element_table.b#10]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$element_table.a#1, $path_scan.$head#8, $element_table.e#6, $path_scan.$tail#9, $element_table.b#10]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=[$path_scan.$head#8, $element_table.e#6, $path_scan.$tail#9]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element1#2]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e#3]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | | | +-orientation=ANY
                  | |   | | | +-GraphNodeScan
                  | |   | | |   +-column_list=[$element_table.$element2#4]
                  | |   | | |   +-label_expr=
                  | |   | | |   | +-GraphLabelNaryExpr
                  | |   | | |   |   +-op=OR
                  | |   | | |   |   +-operand_list=
                  | |   | | |   |     +-GraphWildCardLabel
                  | |   | | |   |     +-GraphLabelNaryExpr
                  | |   | | |   |       +-op=NOT
                  | |   | | |   |       +-operand_list=
                  | |   | | |   |         +-GraphWildCardLabel
                  | |   | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | +-head=$path_scan.$head#8
                  | |   | | +-tail=$path_scan.$tail#9
                  | |   | | +-quantifier=
                  | |   | | | +-GraphPathPatternQuantifier
                  | |   | | |   +-lower_bound=
                  | |   | | |   | +-Literal(type=INT64, value=1)
                  | |   | | |   +-upper_bound=
                  | |   | | |     +-Literal(type=INT64, value=3)
                  | |   | | +-group_variable_list=
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element1#2, array=$element_table.$element1#5)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.e#3, array=$element_table.e#6)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element2#4, array=$element_table.$element2#7)
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.b#10]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.b#10
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#11]
                    +-expr_list=
                    | +-the_answer#11 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, e#6, b#10])

[SQLBUILDER_TARGET_SYNTAX_MODE standard]
[SQLBUILDER_OUTPUT]
SELECT
  aml_1.a_7 AS the_answer
FROM
  GRAPH_TABLE(
    aml
    MATCH
      TRAIL
      (a_2
      IS (% | ! %))
      (
        (a_3
        IS (% | ! %))
        -[a_4
        IS (% | ! %)]-
        (a_5
        IS (% | ! %))
      ) { 1, 3 }
      (a_6
      IS (% | ! %))
    RETURN
      42 AS a_7
  ) AS aml_1;

[SQLBUILDER_TARGET_SYNTAX_MODE pipe]
[SQLBUILDER_OUTPUT]
FROM
  GRAPH_TABLE(
    aml
    MATCH
      TRAIL
      (a_2
      IS (% | ! %))
      (
        (a_3
        IS (% | ! %))
        -[a_4
        IS (% | ! %)]-
        (a_5
        IS (% | ! %))
      ) { 1, 3 }
      (a_6
      IS (% | ! %))
    RETURN
      42 AS a_7
  ) AS aml_1
|> SELECT
     aml_1.a_7 AS the_answer;
==

# ACYCLIC path mode works with quantified paths.
select gt.* from
graph_table(aml
  MATCH ACYCLIC (a)-[e]-{1,3}(b)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#11 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#11]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#11]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#11]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#11]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$element_table.a#1, $path_scan.$head#8, $element_table.$element1#5, $element_table.$element2#7, $path_scan.$tail#9, $element_table.b#10]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$element_table.a#1, $path_scan.$head#8, $element_table.$element1#5, $element_table.$element2#7, $path_scan.$tail#9, $element_table.b#10]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=[$path_scan.$head#8, $element_table.$element1#5, $element_table.$element2#7, $path_scan.$tail#9]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element1#2]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e#3]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | | | +-orientation=ANY
                  | |   | | | +-GraphNodeScan
                  | |   | | |   +-column_list=[$element_table.$element2#4]
                  | |   | | |   +-label_expr=
                  | |   | | |   | +-GraphLabelNaryExpr
                  | |   | | |   |   +-op=OR
                  | |   | | |   |   +-operand_list=
                  | |   | | |   |     +-GraphWildCardLabel
                  | |   | | |   |     +-GraphLabelNaryExpr
                  | |   | | |   |       +-op=NOT
                  | |   | | |   |       +-operand_list=
                  | |   | | |   |         +-GraphWildCardLabel
                  | |   | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | +-head=$path_scan.$head#8
                  | |   | | +-tail=$path_scan.$tail#9
                  | |   | | +-quantifier=
                  | |   | | | +-GraphPathPatternQuantifier
                  | |   | | |   +-lower_bound=
                  | |   | | |   | +-Literal(type=INT64, value=1)
                  | |   | | |   +-upper_bound=
                  | |   | | |     +-Literal(type=INT64, value=3)
                  | |   | | +-group_variable_list=
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element1#2, array=$element_table.$element1#5)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.e#3, array=$element_table.e#6)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element2#4, array=$element_table.$element2#7)
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.b#10]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.b#10
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=ACYCLIC)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#11]
                    +-expr_list=
                    | +-the_answer#11 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#5, $element2#7, b#10])

[SQLBUILDER_TARGET_SYNTAX_MODE standard]
[SQLBUILDER_OUTPUT]
SELECT
  aml_1.a_7 AS the_answer
FROM
  GRAPH_TABLE(
    aml
    MATCH
      ACYCLIC
      (a_2
      IS (% | ! %))
      (
        (a_3
        IS (% | ! %))
        -[a_4
        IS (% | ! %)]-
        (a_5
        IS (% | ! %))
      ) { 1, 3 }
      (a_6
      IS (% | ! %))
    RETURN
      42 AS a_7
  ) AS aml_1;

[SQLBUILDER_TARGET_SYNTAX_MODE pipe]
[SQLBUILDER_OUTPUT]
FROM
  GRAPH_TABLE(
    aml
    MATCH
      ACYCLIC
      (a_2
      IS (% | ! %))
      (
        (a_3
        IS (% | ! %))
        -[a_4
        IS (% | ! %)]-
        (a_5
        IS (% | ! %))
      ) { 1, 3 }
      (a_6
      IS (% | ! %))
    RETURN
      42 AS a_7
  ) AS aml_1
|> SELECT
     aml_1.a_7 AS the_answer;
==

# Nested path modes work.
select gt.* from
graph_table(aml
  MATCH TRAIL (a)(SIMPLE -[e]-)(c)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#6 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#6]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#6]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#6]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#6]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[a#1, $element1#2, e#3, $element2#4, c#5]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[a#1, $element1#2, e#3, $element2#4, c#5]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=$element_table.[$element1#2, e#3, $element2#4]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element1#2]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e#3]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | | | +-orientation=ANY
                  | |   | | | +-GraphNodeScan
                  | |   | | |   +-column_list=[$element_table.$element2#4]
                  | |   | | |   +-label_expr=
                  | |   | | |   | +-GraphLabelNaryExpr
                  | |   | | |   |   +-op=OR
                  | |   | | |   |   +-operand_list=
                  | |   | | |   |     +-GraphWildCardLabel
                  | |   | | |   |     +-GraphLabelNaryExpr
                  | |   | | |   |       +-op=NOT
                  | |   | | |   |       +-operand_list=
                  | |   | | |   |         +-GraphWildCardLabel
                  | |   | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | +-head=$element_table.$element1#2
                  | |   | | +-tail=$element_table.$element2#4
                  | |   | | +-path_mode=
                  | |   | |   +-GraphPathMode(path_mode=SIMPLE)
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.c#5]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.c#5
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#6]
                    +-expr_list=
                    | +-the_answer#6 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, e#3, $element2#4, c#5])

[SQLBUILDER_TARGET_SYNTAX_MODE standard]
[SQLBUILDER_OUTPUT]
SELECT
  aml_1.a_7 AS the_answer
FROM
  GRAPH_TABLE(
    aml
    MATCH
      TRAIL
      (a_2
      IS (% | ! %))
      (
        SIMPLE
        (a_3
        IS (% | ! %))
        -[a_4
        IS (% | ! %)]-
        (a_5
        IS (% | ! %))
      )
      (a_6
      IS (% | ! %))
    RETURN
      42 AS a_7
  ) AS aml_1;

[SQLBUILDER_TARGET_SYNTAX_MODE pipe]
[SQLBUILDER_OUTPUT]
FROM
  GRAPH_TABLE(
    aml
    MATCH
      TRAIL
      (a_2
      IS (% | ! %))
      (
        SIMPLE
        (a_3
        IS (% | ! %))
        -[a_4
        IS (% | ! %)]-
        (a_5
        IS (% | ! %))
      )
      (a_6
      IS (% | ! %))
    RETURN
      42 AS a_7
  ) AS aml_1
|> SELECT
     aml_1.a_7 AS the_answer;
==


# Nested path modes with quantified edges on a path work.
select gt.* from
graph_table(aml
  MATCH (a)(ACYCLIC -[e1]-(n1)-[e2]-{1,3})(b)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#14 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#14]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#14]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#14]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#14]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$element_table.a#1, $element_table.$element1#2, $element_table.e1#3, $element_table.n1#4, $path_scan.$head#11, $element_table.$element2#8, $element_table.$element3#10, $path_scan.$tail#12, $element_table.b#13]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$element_table.a#1, $element_table.$element1#2, $element_table.e1#3, $element_table.n1#4, $path_scan.$head#11, $element_table.$element2#8, $element_table.$element3#10, $path_scan.$tail#12, $element_table.b#13]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=[$element_table.$element1#2, $element_table.e1#3, $element_table.n1#4, $path_scan.$head#11, $element_table.$element2#8, $element_table.$element3#10, $path_scan.$tail#12]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element1#2]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e1#3]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | | | +-orientation=ANY
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.n1#4]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphPathScan
                  | |   | | |   +-column_list=[$path_scan.$head#11, $element_table.$element2#8, $element_table.$element3#10, $path_scan.$tail#12]
                  | |   | | |   +-input_scan_list=
                  | |   | | |   | +-GraphNodeScan
                  | |   | | |   | | +-column_list=[$element_table.$element2#5]
                  | |   | | |   | | +-label_expr=
                  | |   | | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   | | |   +-op=OR
                  | |   | | |   | | |   +-operand_list=
                  | |   | | |   | | |     +-GraphWildCardLabel
                  | |   | | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |   | | |       +-op=NOT
                  | |   | | |   | | |       +-operand_list=
                  | |   | | |   | | |         +-GraphWildCardLabel
                  | |   | | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | |   | +-GraphEdgeScan
                  | |   | | |   | | +-column_list=[$element_table.e2#6]
                  | |   | | |   | | +-label_expr=
                  | |   | | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   | | |   +-op=OR
                  | |   | | |   | | |   +-operand_list=
                  | |   | | |   | | |     +-GraphWildCardLabel
                  | |   | | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |   | | |       +-op=NOT
                  | |   | | |   | | |       +-operand_list=
                  | |   | | |   | | |         +-GraphWildCardLabel
                  | |   | | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | |   | | +-orientation=ANY
                  | |   | | |   | +-GraphNodeScan
                  | |   | | |   |   +-column_list=[$element_table.$element3#7]
                  | |   | | |   |   +-label_expr=
                  | |   | | |   |   | +-GraphLabelNaryExpr
                  | |   | | |   |   |   +-op=OR
                  | |   | | |   |   |   +-operand_list=
                  | |   | | |   |   |     +-GraphWildCardLabel
                  | |   | | |   |   |     +-GraphLabelNaryExpr
                  | |   | | |   |   |       +-op=NOT
                  | |   | | |   |   |       +-operand_list=
                  | |   | | |   |   |         +-GraphWildCardLabel
                  | |   | | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | |   +-head=$path_scan.$head#11
                  | |   | | |   +-tail=$path_scan.$tail#12
                  | |   | | |   +-quantifier=
                  | |   | | |   | +-GraphPathPatternQuantifier
                  | |   | | |   |   +-lower_bound=
                  | |   | | |   |   | +-Literal(type=INT64, value=1)
                  | |   | | |   |   +-upper_bound=
                  | |   | | |   |     +-Literal(type=INT64, value=3)
                  | |   | | |   +-group_variable_list=
                  | |   | | |     +-GraphMakeArrayVariable(element=$element_table.$element2#5, array=$element_table.$element2#8)
                  | |   | | |     +-GraphMakeArrayVariable(element=$element_table.e2#6, array=$element_table.e2#9)
                  | |   | | |     +-GraphMakeArrayVariable(element=$element_table.$element3#7, array=$element_table.$element3#10)
                  | |   | | +-head=$element_table.$element1#2
                  | |   | | +-tail=$path_scan.$tail#12
                  | |   | | +-path_mode=
                  | |   | |   +-GraphPathMode(path_mode=ACYCLIC)
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.b#13]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.b#13
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#14]
                    +-expr_list=
                    | +-the_answer#14 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, e1#3, n1#4, $element2#8, $element3#10, b#13])

[SQLBUILDER_TARGET_SYNTAX_MODE standard]
[SQLBUILDER_OUTPUT]
SELECT
  aml_1.a_10 AS the_answer
FROM
  GRAPH_TABLE(
    aml
    MATCH
      (a_2
      IS (% | ! %))
      (
        ACYCLIC
        (a_3
        IS (% | ! %))
        -[a_4
        IS (% | ! %)]-
        (a_5
        IS (% | ! %))
        (
          (a_6
          IS (% | ! %))
          -[a_7
          IS (% | ! %)]-
          (a_8
          IS (% | ! %))
        ) { 1, 3 }
      )
      (a_9
      IS (% | ! %))
    RETURN
      42 AS a_10
  ) AS aml_1;

[SQLBUILDER_TARGET_SYNTAX_MODE pipe]
[SQLBUILDER_OUTPUT]
FROM
  GRAPH_TABLE(
    aml
    MATCH
      (a_2
      IS (% | ! %))
      (
        ACYCLIC
        (a_3
        IS (% | ! %))
        -[a_4
        IS (% | ! %)]-
        (a_5
        IS (% | ! %))
        (
          (a_6
          IS (% | ! %))
          -[a_7
          IS (% | ! %)]-
          (a_8
          IS (% | ! %))
        ) { 1, 3 }
      )
      (a_9
      IS (% | ! %))
    RETURN
      42 AS a_10
  ) AS aml_1
|> SELECT
     aml_1.a_10 AS the_answer;
==

# TRAIL path mode works with paths created from quantified edges.
select gt.* from
graph_table(aml
  MATCH TRAIL (-[e]-{1,3} WHERE 20>10)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#9 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#9]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#9]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#9]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#9]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$path_scan.$head#7, $element_table.e#5, $path_scan.$tail#8]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$path_scan.$head#7, $element_table.e#5, $path_scan.$tail#8]
                  | |   +-input_scan_list=
                  | |   | +-GraphPathScan
                  | |   |   +-column_list=[$path_scan.$head#7, $element_table.e#5, $path_scan.$tail#8]
                  | |   |   +-input_scan_list=
                  | |   |   | +-GraphPathScan
                  | |   |   |   +-column_list=[$path_scan.$head#7, $element_table.e#5, $path_scan.$tail#8]
                  | |   |   |   +-input_scan_list=
                  | |   |   |   | +-GraphNodeScan
                  | |   |   |   | | +-column_list=[$element_table.$element1#1]
                  | |   |   |   | | +-label_expr=
                  | |   |   |   | | | +-GraphLabelNaryExpr
                  | |   |   |   | | |   +-op=OR
                  | |   |   |   | | |   +-operand_list=
                  | |   |   |   | | |     +-GraphWildCardLabel
                  | |   |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   |   | | |       +-op=NOT
                  | |   |   |   | | |       +-operand_list=
                  | |   |   |   | | |         +-GraphWildCardLabel
                  | |   |   |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   |   | +-GraphEdgeScan
                  | |   |   |   | | +-column_list=[$element_table.e#2]
                  | |   |   |   | | +-label_expr=
                  | |   |   |   | | | +-GraphLabelNaryExpr
                  | |   |   |   | | |   +-op=OR
                  | |   |   |   | | |   +-operand_list=
                  | |   |   |   | | |     +-GraphWildCardLabel
                  | |   |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   |   | | |       +-op=NOT
                  | |   |   |   | | |       +-operand_list=
                  | |   |   |   | | |         +-GraphWildCardLabel
                  | |   |   |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   |   |   | | +-orientation=ANY
                  | |   |   |   | +-GraphNodeScan
                  | |   |   |   |   +-column_list=[$element_table.$element2#3]
                  | |   |   |   |   +-label_expr=
                  | |   |   |   |   | +-GraphLabelNaryExpr
                  | |   |   |   |   |   +-op=OR
                  | |   |   |   |   |   +-operand_list=
                  | |   |   |   |   |     +-GraphWildCardLabel
                  | |   |   |   |   |     +-GraphLabelNaryExpr
                  | |   |   |   |   |       +-op=NOT
                  | |   |   |   |   |       +-operand_list=
                  | |   |   |   |   |         +-GraphWildCardLabel
                  | |   |   |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   |   +-head=$path_scan.$head#7
                  | |   |   |   +-tail=$path_scan.$tail#8
                  | |   |   |   +-quantifier=
                  | |   |   |   | +-GraphPathPatternQuantifier
                  | |   |   |   |   +-lower_bound=
                  | |   |   |   |   | +-Literal(type=INT64, value=1)
                  | |   |   |   |   +-upper_bound=
                  | |   |   |   |     +-Literal(type=INT64, value=3)
                  | |   |   |   +-group_variable_list=
                  | |   |   |     +-GraphMakeArrayVariable(element=$element_table.$element1#1, array=$element_table.$element1#4)
                  | |   |   |     +-GraphMakeArrayVariable(element=$element_table.e#2, array=$element_table.e#5)
                  | |   |   |     +-GraphMakeArrayVariable(element=$element_table.$element2#3, array=$element_table.$element2#6)
                  | |   |   +-filter_expr=
                  | |   |   | +-FunctionCall(ZetaSQL:$greater(INT64, INT64) -> BOOL)
                  | |   |   |   +-Literal(type=INT64, value=20)
                  | |   |   |   +-Literal(type=INT64, value=10)
                  | |   |   +-head=$path_scan.$head#7
                  | |   |   +-tail=$path_scan.$tail#8
                  | |   +-head=$path_scan.$head#7
                  | |   +-tail=$path_scan.$tail#8
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#9]
                    +-expr_list=
                    | +-the_answer#9 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=[$element_table.e#5])

[SQLBUILDER_TARGET_SYNTAX_MODE standard]
[SQLBUILDER_OUTPUT]
SELECT
  aml_1.a_5 AS the_answer
FROM
  GRAPH_TABLE(
    aml
    MATCH
      TRAIL
      (
        (
          (a_2
          IS (% | ! %))
          -[a_3
          IS (% | ! %)]-
          (a_4
          IS (% | ! %))
        ) { 1, 3 }
        WHERE
          20 > 10
      )
    RETURN
      42 AS a_5
  ) AS aml_1;

[SQLBUILDER_TARGET_SYNTAX_MODE pipe]
[SQLBUILDER_OUTPUT]
FROM
  GRAPH_TABLE(
    aml
    MATCH
      TRAIL
      (
        (
          (a_2
          IS (% | ! %))
          -[a_3
          IS (% | ! %)]-
          (a_4
          IS (% | ! %))
        ) { 1, 3 }
        WHERE
          20 > 10
      )
    RETURN
      42 AS a_5
  ) AS aml_1
|> SELECT
     aml_1.a_5 AS the_answer;
==

# Path modes work with paths that have ASTGraphPathPattern nodes stripped.
select gt.* from
graph_table(aml
  MATCH TRAIL (ACYCLIC -)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#4 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#4]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#4]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#4]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#4]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[$element1#1, $element2#2, $element3#3]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[$element1#1, $element2#2, $element3#3]
                  | |   +-input_scan_list=
                  | |   | +-GraphPathScan
                  | |   |   +-column_list=$element_table.[$element1#1, $element2#2, $element3#3]
                  | |   |   +-input_scan_list=
                  | |   |   | +-GraphNodeScan
                  | |   |   | | +-column_list=[$element_table.$element1#1]
                  | |   |   | | +-label_expr=
                  | |   |   | | | +-GraphLabelNaryExpr
                  | |   |   | | |   +-op=OR
                  | |   |   | | |   +-operand_list=
                  | |   |   | | |     +-GraphWildCardLabel
                  | |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   | | |       +-op=NOT
                  | |   |   | | |       +-operand_list=
                  | |   |   | | |         +-GraphWildCardLabel
                  | |   |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   | +-GraphEdgeScan
                  | |   |   | | +-column_list=[$element_table.$element2#2]
                  | |   |   | | +-label_expr=
                  | |   |   | | | +-GraphLabelNaryExpr
                  | |   |   | | |   +-op=OR
                  | |   |   | | |   +-operand_list=
                  | |   |   | | |     +-GraphWildCardLabel
                  | |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   | | |       +-op=NOT
                  | |   |   | | |       +-operand_list=
                  | |   |   | | |         +-GraphWildCardLabel
                  | |   |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   |   | | +-orientation=ANY
                  | |   |   | +-GraphNodeScan
                  | |   |   |   +-column_list=[$element_table.$element3#3]
                  | |   |   |   +-label_expr=
                  | |   |   |   | +-GraphLabelNaryExpr
                  | |   |   |   |   +-op=OR
                  | |   |   |   |   +-operand_list=
                  | |   |   |   |     +-GraphWildCardLabel
                  | |   |   |   |     +-GraphLabelNaryExpr
                  | |   |   |   |       +-op=NOT
                  | |   |   |   |       +-operand_list=
                  | |   |   |   |         +-GraphWildCardLabel
                  | |   |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   +-head=$element_table.$element1#1
                  | |   |   +-tail=$element_table.$element3#3
                  | |   |   +-path_mode=
                  | |   |     +-GraphPathMode(path_mode=ACYCLIC)
                  | |   +-head=$element_table.$element1#1
                  | |   +-tail=$element_table.$element3#3
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#4]
                    +-expr_list=
                    | +-the_answer#4 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[$element1#1, $element2#2, $element3#3])

[SQLBUILDER_TARGET_SYNTAX_MODE standard]
[SQLBUILDER_OUTPUT]
SELECT
  aml_1.a_5 AS the_answer
FROM
  GRAPH_TABLE(
    aml
    MATCH
      TRAIL
      (
        ACYCLIC
        (a_2
        IS (% | ! %))
        -[a_3
        IS (% | ! %)]-
        (a_4
        IS (% | ! %))
      )
    RETURN
      42 AS a_5
  ) AS aml_1;

[SQLBUILDER_TARGET_SYNTAX_MODE pipe]
[SQLBUILDER_OUTPUT]
FROM
  GRAPH_TABLE(
    aml
    MATCH
      TRAIL
      (
        ACYCLIC
        (a_2
        IS (% | ! %))
        -[a_3
        IS (% | ! %)]-
        (a_4
        IS (% | ! %))
      )
    RETURN
      42 AS a_5
  ) AS aml_1
|> SELECT
     aml_1.a_5 AS the_answer;
==

# Path modes work with quantified paths that have been converted from quantified
# edge patterns.
select gt.* from
graph_table(aml
  MATCH TRAIL -{5}
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#9 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#9]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#9]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#9]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#9]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$path_scan.$head#7, $element_table.$element2#5, $path_scan.$tail#8]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$path_scan.$head#7, $element_table.$element2#5, $path_scan.$tail#8]
                  | |   +-input_scan_list=
                  | |   | +-GraphPathScan
                  | |   |   +-column_list=[$path_scan.$head#7, $element_table.$element2#5, $path_scan.$tail#8]
                  | |   |   +-input_scan_list=
                  | |   |   | +-GraphNodeScan
                  | |   |   | | +-column_list=[$element_table.$element1#1]
                  | |   |   | | +-label_expr=
                  | |   |   | | | +-GraphLabelNaryExpr
                  | |   |   | | |   +-op=OR
                  | |   |   | | |   +-operand_list=
                  | |   |   | | |     +-GraphWildCardLabel
                  | |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   | | |       +-op=NOT
                  | |   |   | | |       +-operand_list=
                  | |   |   | | |         +-GraphWildCardLabel
                  | |   |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   | +-GraphEdgeScan
                  | |   |   | | +-column_list=[$element_table.$element2#2]
                  | |   |   | | +-label_expr=
                  | |   |   | | | +-GraphLabelNaryExpr
                  | |   |   | | |   +-op=OR
                  | |   |   | | |   +-operand_list=
                  | |   |   | | |     +-GraphWildCardLabel
                  | |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   | | |       +-op=NOT
                  | |   |   | | |       +-operand_list=
                  | |   |   | | |         +-GraphWildCardLabel
                  | |   |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   |   | | +-orientation=ANY
                  | |   |   | +-GraphNodeScan
                  | |   |   |   +-column_list=[$element_table.$element3#3]
                  | |   |   |   +-label_expr=
                  | |   |   |   | +-GraphLabelNaryExpr
                  | |   |   |   |   +-op=OR
                  | |   |   |   |   +-operand_list=
                  | |   |   |   |     +-GraphWildCardLabel
                  | |   |   |   |     +-GraphLabelNaryExpr
                  | |   |   |   |       +-op=NOT
                  | |   |   |   |       +-operand_list=
                  | |   |   |   |         +-GraphWildCardLabel
                  | |   |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   +-head=$path_scan.$head#7
                  | |   |   +-tail=$path_scan.$tail#8
                  | |   |   +-quantifier=
                  | |   |   | +-GraphPathPatternQuantifier
                  | |   |   |   +-lower_bound=
                  | |   |   |   | +-Literal(type=INT64, value=5)
                  | |   |   |   +-upper_bound=
                  | |   |   |     +-Literal(type=INT64, value=5)
                  | |   |   +-group_variable_list=
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.$element1#1, array=$element_table.$element1#4)
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.$element2#2, array=$element_table.$element2#5)
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.$element3#3, array=$element_table.$element3#6)
                  | |   +-head=$path_scan.$head#7
                  | |   +-tail=$path_scan.$tail#8
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#9]
                    +-expr_list=
                    | +-the_answer#9 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=[$element_table.$element2#5])

[SQLBUILDER_TARGET_SYNTAX_MODE standard]
[SQLBUILDER_OUTPUT]
SELECT
  aml_1.a_5 AS the_answer
FROM
  GRAPH_TABLE(
    aml
    MATCH
      TRAIL
      (
        (a_2
        IS (% | ! %))
        -[a_3
        IS (% | ! %)]-
        (a_4
        IS (% | ! %))
      ) { 5, 5 }
    RETURN
      42 AS a_5
  ) AS aml_1;

[SQLBUILDER_TARGET_SYNTAX_MODE pipe]
[SQLBUILDER_OUTPUT]
FROM
  GRAPH_TABLE(
    aml
    MATCH
      TRAIL
      (
        (a_2
        IS (% | ! %))
        -[a_3
        IS (% | ! %)]-
        (a_4
        IS (% | ! %))
      ) { 5, 5 }
    RETURN
      42 AS a_5
  ) AS aml_1
|> SELECT
     aml_1.a_5 AS the_answer;
==

# Nested path modes work with quantified paths that have been converted from
# quantified edge patterns.
select gt.* from
graph_table(aml
  MATCH TRAIL (SIMPLE -{5})
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#9 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#9]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#9]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#9]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#9]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$path_scan.$head#7, $element_table.$element1#4, $element_table.$element2#5, $element_table.$element3#6, $path_scan.$tail#8]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$path_scan.$head#7, $element_table.$element1#4, $element_table.$element2#5, $element_table.$element3#6, $path_scan.$tail#8]
                  | |   +-input_scan_list=
                  | |   | +-GraphPathScan
                  | |   |   +-column_list=[$path_scan.$head#7, $element_table.$element1#4, $element_table.$element2#5, $element_table.$element3#6, $path_scan.$tail#8]
                  | |   |   +-input_scan_list=
                  | |   |   | +-GraphPathScan
                  | |   |   |   +-column_list=[$path_scan.$head#7, $element_table.$element1#4, $element_table.$element2#5, $element_table.$element3#6, $path_scan.$tail#8]
                  | |   |   |   +-input_scan_list=
                  | |   |   |   | +-GraphNodeScan
                  | |   |   |   | | +-column_list=[$element_table.$element1#1]
                  | |   |   |   | | +-label_expr=
                  | |   |   |   | | | +-GraphLabelNaryExpr
                  | |   |   |   | | |   +-op=OR
                  | |   |   |   | | |   +-operand_list=
                  | |   |   |   | | |     +-GraphWildCardLabel
                  | |   |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   |   | | |       +-op=NOT
                  | |   |   |   | | |       +-operand_list=
                  | |   |   |   | | |         +-GraphWildCardLabel
                  | |   |   |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   |   | +-GraphEdgeScan
                  | |   |   |   | | +-column_list=[$element_table.$element2#2]
                  | |   |   |   | | +-label_expr=
                  | |   |   |   | | | +-GraphLabelNaryExpr
                  | |   |   |   | | |   +-op=OR
                  | |   |   |   | | |   +-operand_list=
                  | |   |   |   | | |     +-GraphWildCardLabel
                  | |   |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   |   | | |       +-op=NOT
                  | |   |   |   | | |       +-operand_list=
                  | |   |   |   | | |         +-GraphWildCardLabel
                  | |   |   |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   |   |   | | +-orientation=ANY
                  | |   |   |   | +-GraphNodeScan
                  | |   |   |   |   +-column_list=[$element_table.$element3#3]
                  | |   |   |   |   +-label_expr=
                  | |   |   |   |   | +-GraphLabelNaryExpr
                  | |   |   |   |   |   +-op=OR
                  | |   |   |   |   |   +-operand_list=
                  | |   |   |   |   |     +-GraphWildCardLabel
                  | |   |   |   |   |     +-GraphLabelNaryExpr
                  | |   |   |   |   |       +-op=NOT
                  | |   |   |   |   |       +-operand_list=
                  | |   |   |   |   |         +-GraphWildCardLabel
                  | |   |   |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   |   +-head=$path_scan.$head#7
                  | |   |   |   +-tail=$path_scan.$tail#8
                  | |   |   |   +-quantifier=
                  | |   |   |   | +-GraphPathPatternQuantifier
                  | |   |   |   |   +-lower_bound=
                  | |   |   |   |   | +-Literal(type=INT64, value=5)
                  | |   |   |   |   +-upper_bound=
                  | |   |   |   |     +-Literal(type=INT64, value=5)
                  | |   |   |   +-group_variable_list=
                  | |   |   |     +-GraphMakeArrayVariable(element=$element_table.$element1#1, array=$element_table.$element1#4)
                  | |   |   |     +-GraphMakeArrayVariable(element=$element_table.$element2#2, array=$element_table.$element2#5)
                  | |   |   |     +-GraphMakeArrayVariable(element=$element_table.$element3#3, array=$element_table.$element3#6)
                  | |   |   +-head=$path_scan.$head#7
                  | |   |   +-tail=$path_scan.$tail#8
                  | |   |   +-path_mode=
                  | |   |     +-GraphPathMode(path_mode=SIMPLE)
                  | |   +-head=$path_scan.$head#7
                  | |   +-tail=$path_scan.$tail#8
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#9]
                    +-expr_list=
                    | +-the_answer#9 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[$element1#4, $element2#5, $element3#6])

[SQLBUILDER_TARGET_SYNTAX_MODE standard]
[SQLBUILDER_OUTPUT]
SELECT
  aml_1.a_5 AS the_answer
FROM
  GRAPH_TABLE(
    aml
    MATCH
      TRAIL
      (
        SIMPLE
        (
          (a_2
          IS (% | ! %))
          -[a_3
          IS (% | ! %)]-
          (a_4
          IS (% | ! %))
        ) { 5, 5 }
      )
    RETURN
      42 AS a_5
  ) AS aml_1;

[SQLBUILDER_TARGET_SYNTAX_MODE pipe]
[SQLBUILDER_OUTPUT]
FROM
  GRAPH_TABLE(
    aml
    MATCH
      TRAIL
      (
        SIMPLE
        (
          (a_2
          IS (% | ! %))
          -[a_3
          IS (% | ! %)]-
          (a_4
          IS (% | ! %))
        ) { 5, 5 }
      )
    RETURN
      42 AS a_5
  ) AS aml_1
|> SELECT
     aml_1.a_5 AS the_answer;
==

[default language_features=NONE,+SQL_GRAPH,+SQL_GRAPH_ADVANCED_QUERY,+SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION,+SQL_GRAPH_PATH_MODE]
[default no_test_extract_table_names]
[default no_run_sqlbuilder]
# No unparser due to SQLBuilder visitor not implemented for GraphMakeElement

# TRAIL path mode on top-level path.
select gt.* from
graph_table(aml
  MATCH TRAIL (a)-(b)-(c)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#6 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#6]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#6]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#6]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#6]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element1#2]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.b#3]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element2#4]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.c#5]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.c#5
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#6]
                    +-expr_list=
                    | +-the_answer#6 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, b#3, $element2#4, c#5])
==

# TRAIL path mode does not apply to whole graph pattern.
select gt.* from
graph_table(aml
  MATCH TRAIL (a)-(b), (b)-(c)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#7 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#7]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#7]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#7]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#7]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[a#1, $element1#2, b#3, b#4, $element2#5, c#6]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | | | +-column_list=$element_table.[a#1, $element1#2, b#3]
                  | | | +-input_scan_list=
                  | | | | +-GraphNodeScan
                  | | | | | +-column_list=[$element_table.a#1]
                  | | | | | +-label_expr=
                  | | | | | | +-GraphLabelNaryExpr
                  | | | | | |   +-op=OR
                  | | | | | |   +-operand_list=
                  | | | | | |     +-GraphWildCardLabel
                  | | | | | |     +-GraphLabelNaryExpr
                  | | | | | |       +-op=NOT
                  | | | | | |       +-operand_list=
                  | | | | | |         +-GraphWildCardLabel
                  | | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | | | | +-GraphEdgeScan
                  | | | | | +-column_list=[$element_table.$element1#2]
                  | | | | | +-label_expr=
                  | | | | | | +-GraphLabelNaryExpr
                  | | | | | |   +-op=OR
                  | | | | | |   +-operand_list=
                  | | | | | |     +-GraphWildCardLabel
                  | | | | | |     +-GraphLabelNaryExpr
                  | | | | | |       +-op=NOT
                  | | | | | |       +-operand_list=
                  | | | | | |         +-GraphWildCardLabel
                  | | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | | | | | +-orientation=ANY
                  | | | | +-GraphNodeScan
                  | | | |   +-column_list=[$element_table.b#3]
                  | | | |   +-label_expr=
                  | | | |   | +-GraphLabelNaryExpr
                  | | | |   |   +-op=AND
                  | | | |   |   +-operand_list=
                  | | | |   |     +-GraphLabelNaryExpr
                  | | | |   |     | +-op=OR
                  | | | |   |     | +-operand_list=
                  | | | |   |     |   +-GraphWildCardLabel
                  | | | |   |     |   +-GraphLabelNaryExpr
                  | | | |   |     |     +-op=NOT
                  | | | |   |     |     +-operand_list=
                  | | | |   |     |       +-GraphWildCardLabel
                  | | | |   |     +-GraphLabelNaryExpr
                  | | | |   |       +-op=OR
                  | | | |   |       +-operand_list=
                  | | | |   |         +-GraphWildCardLabel
                  | | | |   |         +-GraphLabelNaryExpr
                  | | | |   |           +-op=NOT
                  | | | |   |           +-operand_list=
                  | | | |   |             +-GraphWildCardLabel
                  | | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | | | +-head=$element_table.a#1
                  | | | +-tail=$element_table.b#3
                  | | | +-path_mode=
                  | | |   +-GraphPathMode(path_mode=TRAIL)
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[b#4, $element2#5, c#6]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.b#4]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=AND
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |     | +-op=OR
                  | |   | | |     | +-operand_list=
                  | |   | | |     |   +-GraphWildCardLabel
                  | |   | | |     |   +-GraphLabelNaryExpr
                  | |   | | |     |     +-op=NOT
                  | |   | | |     |     +-operand_list=
                  | |   | | |     |       +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=OR
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | |         +-GraphLabelNaryExpr
                  | |   | | |           +-op=NOT
                  | |   | | |           +-operand_list=
                  | |   | | |             +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.$element2#5]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.c#6]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.b#4
                  | |   +-tail=$element_table.c#6
                  | +-filter_expr=
                  | | +-FunctionCall(ZetaSQL:$equal(GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>) -> BOOL)
                  | |   +-ColumnRef(type=GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, column=$element_table.b#3)
                  | |   +-ColumnRef(type=GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, column=$element_table.b#4)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#7]
                    +-expr_list=
                    | +-the_answer#7 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, b#3, $element2#5, c#6])
==

# TRAIL path mode works with quantified paths.
select gt.* from
graph_table(aml
  MATCH TRAIL (a)-[e]-{1,3}(b)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#11 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#11]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#11]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#11]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#11]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$element_table.a#1, $path_scan.$head#8, $element_table.e#6, $path_scan.$tail#9, $element_table.b#10]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$element_table.a#1, $path_scan.$head#8, $element_table.e#6, $path_scan.$tail#9, $element_table.b#10]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=[$path_scan.$head#8, $element_table.e#6, $path_scan.$tail#9]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element1#2]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e#3]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | | | +-orientation=ANY
                  | |   | | | +-GraphNodeScan
                  | |   | | |   +-column_list=[$element_table.$element2#4]
                  | |   | | |   +-label_expr=
                  | |   | | |   | +-GraphLabelNaryExpr
                  | |   | | |   |   +-op=OR
                  | |   | | |   |   +-operand_list=
                  | |   | | |   |     +-GraphWildCardLabel
                  | |   | | |   |     +-GraphLabelNaryExpr
                  | |   | | |   |       +-op=NOT
                  | |   | | |   |       +-operand_list=
                  | |   | | |   |         +-GraphWildCardLabel
                  | |   | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | +-head=$path_scan.$head#8
                  | |   | | +-tail=$path_scan.$tail#9
                  | |   | | +-quantifier=
                  | |   | | | +-GraphPathPatternQuantifier
                  | |   | | |   +-lower_bound=
                  | |   | | |   | +-Literal(type=INT64, value=1)
                  | |   | | |   +-upper_bound=
                  | |   | | |     +-Literal(type=INT64, value=3)
                  | |   | | +-group_variable_list=
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element1#2, array=$element_table.$element1#5)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.e#3, array=$element_table.e#6)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element2#4, array=$element_table.$element2#7)
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.b#10]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.b#10
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#11]
                    +-expr_list=
                    | +-the_answer#11 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, e#6, b#10])
==

# ACYCLIC path mode works with quantified paths.
select gt.* from
graph_table(aml
  MATCH ACYCLIC (a)-[e]-{1,3}(b)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#11 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#11]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#11]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#11]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#11]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$element_table.a#1, $path_scan.$head#8, $element_table.$element1#5, $element_table.$element2#7, $path_scan.$tail#9, $element_table.b#10]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$element_table.a#1, $path_scan.$head#8, $element_table.$element1#5, $element_table.$element2#7, $path_scan.$tail#9, $element_table.b#10]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=[$path_scan.$head#8, $element_table.$element1#5, $element_table.$element2#7, $path_scan.$tail#9]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element1#2]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e#3]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | | | +-orientation=ANY
                  | |   | | | +-GraphNodeScan
                  | |   | | |   +-column_list=[$element_table.$element2#4]
                  | |   | | |   +-label_expr=
                  | |   | | |   | +-GraphLabelNaryExpr
                  | |   | | |   |   +-op=OR
                  | |   | | |   |   +-operand_list=
                  | |   | | |   |     +-GraphWildCardLabel
                  | |   | | |   |     +-GraphLabelNaryExpr
                  | |   | | |   |       +-op=NOT
                  | |   | | |   |       +-operand_list=
                  | |   | | |   |         +-GraphWildCardLabel
                  | |   | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | +-head=$path_scan.$head#8
                  | |   | | +-tail=$path_scan.$tail#9
                  | |   | | +-quantifier=
                  | |   | | | +-GraphPathPatternQuantifier
                  | |   | | |   +-lower_bound=
                  | |   | | |   | +-Literal(type=INT64, value=1)
                  | |   | | |   +-upper_bound=
                  | |   | | |     +-Literal(type=INT64, value=3)
                  | |   | | +-group_variable_list=
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element1#2, array=$element_table.$element1#5)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.e#3, array=$element_table.e#6)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element2#4, array=$element_table.$element2#7)
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.b#10]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.b#10
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=ACYCLIC)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#11]
                    +-expr_list=
                    | +-the_answer#11 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#5, $element2#7, b#10])
==

# Nested TRAIL path modes work.
# They might not make sense for TRAIL, but they work.
select gt.* from
graph_table(aml
  MATCH TRAIL (a)(TRAIL -[e]-)(b)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#6 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#6]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#6]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#6]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#6]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[a#1, $element1#2, e#3, $element2#4, b#5]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[a#1, $element1#2, e#3, $element2#4, b#5]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=$element_table.[$element1#2, e#3, $element2#4]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element1#2]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e#3]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | | | +-orientation=ANY
                  | |   | | | +-GraphNodeScan
                  | |   | | |   +-column_list=[$element_table.$element2#4]
                  | |   | | |   +-label_expr=
                  | |   | | |   | +-GraphLabelNaryExpr
                  | |   | | |   |   +-op=OR
                  | |   | | |   |   +-operand_list=
                  | |   | | |   |     +-GraphWildCardLabel
                  | |   | | |   |     +-GraphLabelNaryExpr
                  | |   | | |   |       +-op=NOT
                  | |   | | |   |       +-operand_list=
                  | |   | | |   |         +-GraphWildCardLabel
                  | |   | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | +-head=$element_table.$element1#2
                  | |   | | +-tail=$element_table.$element2#4
                  | |   | | +-path_mode=
                  | |   | |   +-GraphPathMode(path_mode=TRAIL)
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.b#5]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.b#5
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#6]
                    +-expr_list=
                    | +-the_answer#6 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, e#3, $element2#4, b#5])
==

# Nested ACYCLIC path modes work.
# They might not make sense for ACYCLIC, but they work.
select gt.* from
graph_table(aml
  MATCH ACYCLIC (a)(ACYCLIC -[e]-)(b)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#6 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#6]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#6]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#6]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#6]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[a#1, $element1#2, e#3, $element2#4, b#5]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[a#1, $element1#2, e#3, $element2#4, b#5]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=$element_table.[$element1#2, e#3, $element2#4]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element1#2]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e#3]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | | | +-orientation=ANY
                  | |   | | | +-GraphNodeScan
                  | |   | | |   +-column_list=[$element_table.$element2#4]
                  | |   | | |   +-label_expr=
                  | |   | | |   | +-GraphLabelNaryExpr
                  | |   | | |   |   +-op=OR
                  | |   | | |   |   +-operand_list=
                  | |   | | |   |     +-GraphWildCardLabel
                  | |   | | |   |     +-GraphLabelNaryExpr
                  | |   | | |   |       +-op=NOT
                  | |   | | |   |       +-operand_list=
                  | |   | | |   |         +-GraphWildCardLabel
                  | |   | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | +-head=$element_table.$element1#2
                  | |   | | +-tail=$element_table.$element2#4
                  | |   | | +-path_mode=
                  | |   | |   +-GraphPathMode(path_mode=ACYCLIC)
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.b#5]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.b#5
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=ACYCLIC)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#6]
                    +-expr_list=
                    | +-the_answer#6 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, e#3, $element2#4, b#5])
==

# Nested TRAIL path mode with quantified edges on a path work.
select gt.* from
graph_table(aml
  MATCH (a)(TRAIL -[e1]-(n1)-[e2]-{1,3})(b)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#14 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#14]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#14]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#14]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#14]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$element_table.a#1, $element_table.$element1#2, $element_table.e1#3, $element_table.n1#4, $path_scan.$head#11, $element_table.e2#9, $path_scan.$tail#12, $element_table.b#13]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$element_table.a#1, $element_table.$element1#2, $element_table.e1#3, $element_table.n1#4, $path_scan.$head#11, $element_table.e2#9, $path_scan.$tail#12, $element_table.b#13]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=[$element_table.$element1#2, $element_table.e1#3, $element_table.n1#4, $path_scan.$head#11, $element_table.e2#9, $path_scan.$tail#12]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element1#2]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e1#3]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | | | +-orientation=ANY
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.n1#4]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphPathScan
                  | |   | | |   +-column_list=[$path_scan.$head#11, $element_table.e2#9, $path_scan.$tail#12]
                  | |   | | |   +-input_scan_list=
                  | |   | | |   | +-GraphNodeScan
                  | |   | | |   | | +-column_list=[$element_table.$element2#5]
                  | |   | | |   | | +-label_expr=
                  | |   | | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   | | |   +-op=OR
                  | |   | | |   | | |   +-operand_list=
                  | |   | | |   | | |     +-GraphWildCardLabel
                  | |   | | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |   | | |       +-op=NOT
                  | |   | | |   | | |       +-operand_list=
                  | |   | | |   | | |         +-GraphWildCardLabel
                  | |   | | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | |   | +-GraphEdgeScan
                  | |   | | |   | | +-column_list=[$element_table.e2#6]
                  | |   | | |   | | +-label_expr=
                  | |   | | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   | | |   +-op=OR
                  | |   | | |   | | |   +-operand_list=
                  | |   | | |   | | |     +-GraphWildCardLabel
                  | |   | | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |   | | |       +-op=NOT
                  | |   | | |   | | |       +-operand_list=
                  | |   | | |   | | |         +-GraphWildCardLabel
                  | |   | | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | |   | | +-orientation=ANY
                  | |   | | |   | +-GraphNodeScan
                  | |   | | |   |   +-column_list=[$element_table.$element3#7]
                  | |   | | |   |   +-label_expr=
                  | |   | | |   |   | +-GraphLabelNaryExpr
                  | |   | | |   |   |   +-op=OR
                  | |   | | |   |   |   +-operand_list=
                  | |   | | |   |   |     +-GraphWildCardLabel
                  | |   | | |   |   |     +-GraphLabelNaryExpr
                  | |   | | |   |   |       +-op=NOT
                  | |   | | |   |   |       +-operand_list=
                  | |   | | |   |   |         +-GraphWildCardLabel
                  | |   | | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | |   +-head=$path_scan.$head#11
                  | |   | | |   +-tail=$path_scan.$tail#12
                  | |   | | |   +-quantifier=
                  | |   | | |   | +-GraphPathPatternQuantifier
                  | |   | | |   |   +-lower_bound=
                  | |   | | |   |   | +-Literal(type=INT64, value=1)
                  | |   | | |   |   +-upper_bound=
                  | |   | | |   |     +-Literal(type=INT64, value=3)
                  | |   | | |   +-group_variable_list=
                  | |   | | |     +-GraphMakeArrayVariable(element=$element_table.$element2#5, array=$element_table.$element2#8)
                  | |   | | |     +-GraphMakeArrayVariable(element=$element_table.e2#6, array=$element_table.e2#9)
                  | |   | | |     +-GraphMakeArrayVariable(element=$element_table.$element3#7, array=$element_table.$element3#10)
                  | |   | | +-head=$element_table.$element1#2
                  | |   | | +-tail=$path_scan.$tail#12
                  | |   | | +-path_mode=
                  | |   | |   +-GraphPathMode(path_mode=TRAIL)
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.b#13]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.b#13
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#14]
                    +-expr_list=
                    | +-the_answer#14 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, e1#3, n1#4, e2#9, b#13])
==

# Nested ACYCLIC path mode with quantified edges on a path work.
select gt.* from
graph_table(aml
  MATCH (a)(ACYCLIC -[e1]-(n1)-[e2]-{1,3})(b)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#14 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#14]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#14]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#14]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#14]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$element_table.a#1, $element_table.$element1#2, $element_table.e1#3, $element_table.n1#4, $path_scan.$head#11, $element_table.$element2#8, $element_table.$element3#10, $path_scan.$tail#12, $element_table.b#13]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$element_table.a#1, $element_table.$element1#2, $element_table.e1#3, $element_table.n1#4, $path_scan.$head#11, $element_table.$element2#8, $element_table.$element3#10, $path_scan.$tail#12, $element_table.b#13]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=[$element_table.$element1#2, $element_table.e1#3, $element_table.n1#4, $path_scan.$head#11, $element_table.$element2#8, $element_table.$element3#10, $path_scan.$tail#12]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element1#2]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e1#3]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | | | +-orientation=ANY
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.n1#4]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphPathScan
                  | |   | | |   +-column_list=[$path_scan.$head#11, $element_table.$element2#8, $element_table.$element3#10, $path_scan.$tail#12]
                  | |   | | |   +-input_scan_list=
                  | |   | | |   | +-GraphNodeScan
                  | |   | | |   | | +-column_list=[$element_table.$element2#5]
                  | |   | | |   | | +-label_expr=
                  | |   | | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   | | |   +-op=OR
                  | |   | | |   | | |   +-operand_list=
                  | |   | | |   | | |     +-GraphWildCardLabel
                  | |   | | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |   | | |       +-op=NOT
                  | |   | | |   | | |       +-operand_list=
                  | |   | | |   | | |         +-GraphWildCardLabel
                  | |   | | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | |   | +-GraphEdgeScan
                  | |   | | |   | | +-column_list=[$element_table.e2#6]
                  | |   | | |   | | +-label_expr=
                  | |   | | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   | | |   +-op=OR
                  | |   | | |   | | |   +-operand_list=
                  | |   | | |   | | |     +-GraphWildCardLabel
                  | |   | | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |   | | |       +-op=NOT
                  | |   | | |   | | |       +-operand_list=
                  | |   | | |   | | |         +-GraphWildCardLabel
                  | |   | | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | |   | | +-orientation=ANY
                  | |   | | |   | +-GraphNodeScan
                  | |   | | |   |   +-column_list=[$element_table.$element3#7]
                  | |   | | |   |   +-label_expr=
                  | |   | | |   |   | +-GraphLabelNaryExpr
                  | |   | | |   |   |   +-op=OR
                  | |   | | |   |   |   +-operand_list=
                  | |   | | |   |   |     +-GraphWildCardLabel
                  | |   | | |   |   |     +-GraphLabelNaryExpr
                  | |   | | |   |   |       +-op=NOT
                  | |   | | |   |   |       +-operand_list=
                  | |   | | |   |   |         +-GraphWildCardLabel
                  | |   | | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | |   +-head=$path_scan.$head#11
                  | |   | | |   +-tail=$path_scan.$tail#12
                  | |   | | |   +-quantifier=
                  | |   | | |   | +-GraphPathPatternQuantifier
                  | |   | | |   |   +-lower_bound=
                  | |   | | |   |   | +-Literal(type=INT64, value=1)
                  | |   | | |   |   +-upper_bound=
                  | |   | | |   |     +-Literal(type=INT64, value=3)
                  | |   | | |   +-group_variable_list=
                  | |   | | |     +-GraphMakeArrayVariable(element=$element_table.$element2#5, array=$element_table.$element2#8)
                  | |   | | |     +-GraphMakeArrayVariable(element=$element_table.e2#6, array=$element_table.e2#9)
                  | |   | | |     +-GraphMakeArrayVariable(element=$element_table.$element3#7, array=$element_table.$element3#10)
                  | |   | | +-head=$element_table.$element1#2
                  | |   | | +-tail=$path_scan.$tail#12
                  | |   | | +-path_mode=
                  | |   | |   +-GraphPathMode(path_mode=ACYCLIC)
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.b#13]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.b#13
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#14]
                    +-expr_list=
                    | +-the_answer#14 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, $element1#2, e1#3, n1#4, $element2#8, $element3#10, b#13])
==

# TRAIL path mode works with paths created from quantified edges.
select gt.* from
graph_table(aml
  MATCH TRAIL (-[e]-{1,3} WHERE 20>10)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#9 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#9]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#9]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#9]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#9]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$path_scan.$head#7, $element_table.e#5, $path_scan.$tail#8]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$path_scan.$head#7, $element_table.e#5, $path_scan.$tail#8]
                  | |   +-input_scan_list=
                  | |   | +-GraphPathScan
                  | |   |   +-column_list=[$path_scan.$head#7, $element_table.e#5, $path_scan.$tail#8]
                  | |   |   +-input_scan_list=
                  | |   |   | +-GraphPathScan
                  | |   |   |   +-column_list=[$path_scan.$head#7, $element_table.e#5, $path_scan.$tail#8]
                  | |   |   |   +-input_scan_list=
                  | |   |   |   | +-GraphNodeScan
                  | |   |   |   | | +-column_list=[$element_table.$element1#1]
                  | |   |   |   | | +-label_expr=
                  | |   |   |   | | | +-GraphLabelNaryExpr
                  | |   |   |   | | |   +-op=OR
                  | |   |   |   | | |   +-operand_list=
                  | |   |   |   | | |     +-GraphWildCardLabel
                  | |   |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   |   | | |       +-op=NOT
                  | |   |   |   | | |       +-operand_list=
                  | |   |   |   | | |         +-GraphWildCardLabel
                  | |   |   |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   |   | +-GraphEdgeScan
                  | |   |   |   | | +-column_list=[$element_table.e#2]
                  | |   |   |   | | +-label_expr=
                  | |   |   |   | | | +-GraphLabelNaryExpr
                  | |   |   |   | | |   +-op=OR
                  | |   |   |   | | |   +-operand_list=
                  | |   |   |   | | |     +-GraphWildCardLabel
                  | |   |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   |   | | |       +-op=NOT
                  | |   |   |   | | |       +-operand_list=
                  | |   |   |   | | |         +-GraphWildCardLabel
                  | |   |   |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   |   |   | | +-orientation=ANY
                  | |   |   |   | +-GraphNodeScan
                  | |   |   |   |   +-column_list=[$element_table.$element2#3]
                  | |   |   |   |   +-label_expr=
                  | |   |   |   |   | +-GraphLabelNaryExpr
                  | |   |   |   |   |   +-op=OR
                  | |   |   |   |   |   +-operand_list=
                  | |   |   |   |   |     +-GraphWildCardLabel
                  | |   |   |   |   |     +-GraphLabelNaryExpr
                  | |   |   |   |   |       +-op=NOT
                  | |   |   |   |   |       +-operand_list=
                  | |   |   |   |   |         +-GraphWildCardLabel
                  | |   |   |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   |   +-head=$path_scan.$head#7
                  | |   |   |   +-tail=$path_scan.$tail#8
                  | |   |   |   +-quantifier=
                  | |   |   |   | +-GraphPathPatternQuantifier
                  | |   |   |   |   +-lower_bound=
                  | |   |   |   |   | +-Literal(type=INT64, value=1)
                  | |   |   |   |   +-upper_bound=
                  | |   |   |   |     +-Literal(type=INT64, value=3)
                  | |   |   |   +-group_variable_list=
                  | |   |   |     +-GraphMakeArrayVariable(element=$element_table.$element1#1, array=$element_table.$element1#4)
                  | |   |   |     +-GraphMakeArrayVariable(element=$element_table.e#2, array=$element_table.e#5)
                  | |   |   |     +-GraphMakeArrayVariable(element=$element_table.$element2#3, array=$element_table.$element2#6)
                  | |   |   +-filter_expr=
                  | |   |   | +-FunctionCall(ZetaSQL:$greater(INT64, INT64) -> BOOL)
                  | |   |   |   +-Literal(type=INT64, value=20)
                  | |   |   |   +-Literal(type=INT64, value=10)
                  | |   |   +-head=$path_scan.$head#7
                  | |   |   +-tail=$path_scan.$tail#8
                  | |   +-head=$path_scan.$head#7
                  | |   +-tail=$path_scan.$tail#8
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#9]
                    +-expr_list=
                    | +-the_answer#9 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=[$element_table.e#5])
==

# Path modes work with paths that have ASTGraphPathPattern nodes stripped.
select gt.* from
graph_table(aml
  MATCH TRAIL (ACYCLIC -)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#4 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#4]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#4]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#4]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#4]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[$element1#1, $element2#2, $element3#3]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[$element1#1, $element2#2, $element3#3]
                  | |   +-input_scan_list=
                  | |   | +-GraphPathScan
                  | |   |   +-column_list=$element_table.[$element1#1, $element2#2, $element3#3]
                  | |   |   +-input_scan_list=
                  | |   |   | +-GraphNodeScan
                  | |   |   | | +-column_list=[$element_table.$element1#1]
                  | |   |   | | +-label_expr=
                  | |   |   | | | +-GraphLabelNaryExpr
                  | |   |   | | |   +-op=OR
                  | |   |   | | |   +-operand_list=
                  | |   |   | | |     +-GraphWildCardLabel
                  | |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   | | |       +-op=NOT
                  | |   |   | | |       +-operand_list=
                  | |   |   | | |         +-GraphWildCardLabel
                  | |   |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   | +-GraphEdgeScan
                  | |   |   | | +-column_list=[$element_table.$element2#2]
                  | |   |   | | +-label_expr=
                  | |   |   | | | +-GraphLabelNaryExpr
                  | |   |   | | |   +-op=OR
                  | |   |   | | |   +-operand_list=
                  | |   |   | | |     +-GraphWildCardLabel
                  | |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   | | |       +-op=NOT
                  | |   |   | | |       +-operand_list=
                  | |   |   | | |         +-GraphWildCardLabel
                  | |   |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   |   | | +-orientation=ANY
                  | |   |   | +-GraphNodeScan
                  | |   |   |   +-column_list=[$element_table.$element3#3]
                  | |   |   |   +-label_expr=
                  | |   |   |   | +-GraphLabelNaryExpr
                  | |   |   |   |   +-op=OR
                  | |   |   |   |   +-operand_list=
                  | |   |   |   |     +-GraphWildCardLabel
                  | |   |   |   |     +-GraphLabelNaryExpr
                  | |   |   |   |       +-op=NOT
                  | |   |   |   |       +-operand_list=
                  | |   |   |   |         +-GraphWildCardLabel
                  | |   |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   +-head=$element_table.$element1#1
                  | |   |   +-tail=$element_table.$element3#3
                  | |   |   +-path_mode=
                  | |   |     +-GraphPathMode(path_mode=ACYCLIC)
                  | |   +-head=$element_table.$element1#1
                  | |   +-tail=$element_table.$element3#3
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#4]
                    +-expr_list=
                    | +-the_answer#4 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[$element1#1, $element2#2, $element3#3])
==

# TRAIL path modes work with quantified paths that have been converted from
# quantified edge patterns.
select gt.* from
graph_table(aml
  MATCH TRAIL -{5}
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#9 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#9]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#9]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#9]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#9]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$path_scan.$head#7, $element_table.$element2#5, $path_scan.$tail#8]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$path_scan.$head#7, $element_table.$element2#5, $path_scan.$tail#8]
                  | |   +-input_scan_list=
                  | |   | +-GraphPathScan
                  | |   |   +-column_list=[$path_scan.$head#7, $element_table.$element2#5, $path_scan.$tail#8]
                  | |   |   +-input_scan_list=
                  | |   |   | +-GraphNodeScan
                  | |   |   | | +-column_list=[$element_table.$element1#1]
                  | |   |   | | +-label_expr=
                  | |   |   | | | +-GraphLabelNaryExpr
                  | |   |   | | |   +-op=OR
                  | |   |   | | |   +-operand_list=
                  | |   |   | | |     +-GraphWildCardLabel
                  | |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   | | |       +-op=NOT
                  | |   |   | | |       +-operand_list=
                  | |   |   | | |         +-GraphWildCardLabel
                  | |   |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   | +-GraphEdgeScan
                  | |   |   | | +-column_list=[$element_table.$element2#2]
                  | |   |   | | +-label_expr=
                  | |   |   | | | +-GraphLabelNaryExpr
                  | |   |   | | |   +-op=OR
                  | |   |   | | |   +-operand_list=
                  | |   |   | | |     +-GraphWildCardLabel
                  | |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   | | |       +-op=NOT
                  | |   |   | | |       +-operand_list=
                  | |   |   | | |         +-GraphWildCardLabel
                  | |   |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   |   | | +-orientation=ANY
                  | |   |   | +-GraphNodeScan
                  | |   |   |   +-column_list=[$element_table.$element3#3]
                  | |   |   |   +-label_expr=
                  | |   |   |   | +-GraphLabelNaryExpr
                  | |   |   |   |   +-op=OR
                  | |   |   |   |   +-operand_list=
                  | |   |   |   |     +-GraphWildCardLabel
                  | |   |   |   |     +-GraphLabelNaryExpr
                  | |   |   |   |       +-op=NOT
                  | |   |   |   |       +-operand_list=
                  | |   |   |   |         +-GraphWildCardLabel
                  | |   |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   +-head=$path_scan.$head#7
                  | |   |   +-tail=$path_scan.$tail#8
                  | |   |   +-quantifier=
                  | |   |   | +-GraphPathPatternQuantifier
                  | |   |   |   +-lower_bound=
                  | |   |   |   | +-Literal(type=INT64, value=5)
                  | |   |   |   +-upper_bound=
                  | |   |   |     +-Literal(type=INT64, value=5)
                  | |   |   +-group_variable_list=
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.$element1#1, array=$element_table.$element1#4)
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.$element2#2, array=$element_table.$element2#5)
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.$element3#3, array=$element_table.$element3#6)
                  | |   +-head=$path_scan.$head#7
                  | |   +-tail=$path_scan.$tail#8
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#9]
                    +-expr_list=
                    | +-the_answer#9 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=[$element_table.$element2#5])
==

# TRAIL path modes with multiple scalar and quantified edges work.
select gt.* from
graph_table(aml
  MATCH TRAIL (a)-[e1]-(b)-[e2]-{1}-[e3]-{1}(b)-[e4]-(c)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#23 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#23]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#23]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#23]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#23]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$element_table.a#1, $element_table.e1#2, $element_table.b#3, $path_scan.$head#10, $element_table.e2#8, $path_scan.$tail#11, $path_scan.$head#18, $element_table.e3#16, $path_scan.$tail#19, $element_table.b#20, $element_table.e4#21, $element_table.c#22]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$element_table.a#1, $element_table.e1#2, $element_table.b#3, $path_scan.$head#10, $element_table.e2#8, $path_scan.$tail#11, $path_scan.$head#18, $element_table.e3#16, $path_scan.$tail#19, $element_table.b#20, $element_table.e4#21, $element_table.c#22]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.e1#2]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.b#3]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=AND
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |     | +-op=OR
                  | |   | | |     | +-operand_list=
                  | |   | | |     |   +-GraphWildCardLabel
                  | |   | | |     |   +-GraphLabelNaryExpr
                  | |   | | |     |     +-op=NOT
                  | |   | | |     |     +-operand_list=
                  | |   | | |     |       +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=OR
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | |         +-GraphLabelNaryExpr
                  | |   | | |           +-op=NOT
                  | |   | | |           +-operand_list=
                  | |   | | |             +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=[$path_scan.$head#10, $element_table.e2#8, $path_scan.$tail#11]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element1#4]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e2#5]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | | | +-orientation=ANY
                  | |   | | | +-GraphNodeScan
                  | |   | | |   +-column_list=[$element_table.$element2#6]
                  | |   | | |   +-label_expr=
                  | |   | | |   | +-GraphLabelNaryExpr
                  | |   | | |   |   +-op=OR
                  | |   | | |   |   +-operand_list=
                  | |   | | |   |     +-GraphWildCardLabel
                  | |   | | |   |     +-GraphLabelNaryExpr
                  | |   | | |   |       +-op=NOT
                  | |   | | |   |       +-operand_list=
                  | |   | | |   |         +-GraphWildCardLabel
                  | |   | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | +-head=$path_scan.$head#10
                  | |   | | +-tail=$path_scan.$tail#11
                  | |   | | +-quantifier=
                  | |   | | | +-GraphPathPatternQuantifier
                  | |   | | |   +-lower_bound=
                  | |   | | |   | +-Literal(type=INT64, value=1)
                  | |   | | |   +-upper_bound=
                  | |   | | |     +-Literal(type=INT64, value=1)
                  | |   | | +-group_variable_list=
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element1#4, array=$element_table.$element1#7)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.e2#5, array=$element_table.e2#8)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element2#6, array=$element_table.$element2#9)
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=[$path_scan.$head#18, $element_table.e3#16, $path_scan.$tail#19]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element3#12]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e3#13]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | | | +-orientation=ANY
                  | |   | | | +-GraphNodeScan
                  | |   | | |   +-column_list=[$element_table.$element4#14]
                  | |   | | |   +-label_expr=
                  | |   | | |   | +-GraphLabelNaryExpr
                  | |   | | |   |   +-op=OR
                  | |   | | |   |   +-operand_list=
                  | |   | | |   |     +-GraphWildCardLabel
                  | |   | | |   |     +-GraphLabelNaryExpr
                  | |   | | |   |       +-op=NOT
                  | |   | | |   |       +-operand_list=
                  | |   | | |   |         +-GraphWildCardLabel
                  | |   | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | +-head=$path_scan.$head#18
                  | |   | | +-tail=$path_scan.$tail#19
                  | |   | | +-quantifier=
                  | |   | | | +-GraphPathPatternQuantifier
                  | |   | | |   +-lower_bound=
                  | |   | | |   | +-Literal(type=INT64, value=1)
                  | |   | | |   +-upper_bound=
                  | |   | | |     +-Literal(type=INT64, value=1)
                  | |   | | +-group_variable_list=
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element3#12, array=$element_table.$element3#15)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.e3#13, array=$element_table.e3#16)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element4#14, array=$element_table.$element4#17)
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.b#20]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=AND
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |     | +-op=OR
                  | |   | | |     | +-operand_list=
                  | |   | | |     |   +-GraphWildCardLabel
                  | |   | | |     |   +-GraphLabelNaryExpr
                  | |   | | |     |     +-op=NOT
                  | |   | | |     |     +-operand_list=
                  | |   | | |     |       +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=OR
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | |         +-GraphLabelNaryExpr
                  | |   | | |           +-op=NOT
                  | |   | | |           +-operand_list=
                  | |   | | |             +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.e4#21]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.c#22]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-filter_expr=
                  | |   | +-FunctionCall(ZetaSQL:$equal(GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>) -> BOOL)
                  | |   |   +-ColumnRef(type=GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, column=$element_table.b#3)
                  | |   |   +-ColumnRef(type=GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, column=$element_table.b#20)
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.c#22
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#23]
                    +-expr_list=
                    | +-the_answer#23 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, e1#2, b#3, e2#8, e3#16, e4#21, c#22])
==

# ACYCLIC path modes with multiple scalar and quantified nodes work.
select gt.* from
graph_table(aml
  MATCH ACYCLIC (a)-[e1]-(b)-[e2]-{1}-[e3]-{1}(b)-[e4]-(c)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#23 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#23]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#23]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#23]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#23]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$element_table.a#1, $element_table.e1#2, $element_table.b#3, $path_scan.$head#10, $element_table.$element1#7, $element_table.$element2#9, $path_scan.$tail#11, $path_scan.$head#18, $element_table.$element3#15, $element_table.$element4#17, $path_scan.$tail#19, $element_table.b#20, $element_table.e4#21, $element_table.c#22]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$element_table.a#1, $element_table.e1#2, $element_table.b#3, $path_scan.$head#10, $element_table.$element1#7, $element_table.$element2#9, $path_scan.$tail#11, $path_scan.$head#18, $element_table.$element3#15, $element_table.$element4#17, $path_scan.$tail#19, $element_table.b#20, $element_table.e4#21, $element_table.c#22]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.e1#2]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.b#3]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=AND
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |     | +-op=OR
                  | |   | | |     | +-operand_list=
                  | |   | | |     |   +-GraphWildCardLabel
                  | |   | | |     |   +-GraphLabelNaryExpr
                  | |   | | |     |     +-op=NOT
                  | |   | | |     |     +-operand_list=
                  | |   | | |     |       +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=OR
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | |         +-GraphLabelNaryExpr
                  | |   | | |           +-op=NOT
                  | |   | | |           +-operand_list=
                  | |   | | |             +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=[$path_scan.$head#10, $element_table.$element1#7, $element_table.$element2#9, $path_scan.$tail#11]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element1#4]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e2#5]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | | | +-orientation=ANY
                  | |   | | | +-GraphNodeScan
                  | |   | | |   +-column_list=[$element_table.$element2#6]
                  | |   | | |   +-label_expr=
                  | |   | | |   | +-GraphLabelNaryExpr
                  | |   | | |   |   +-op=OR
                  | |   | | |   |   +-operand_list=
                  | |   | | |   |     +-GraphWildCardLabel
                  | |   | | |   |     +-GraphLabelNaryExpr
                  | |   | | |   |       +-op=NOT
                  | |   | | |   |       +-operand_list=
                  | |   | | |   |         +-GraphWildCardLabel
                  | |   | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | +-head=$path_scan.$head#10
                  | |   | | +-tail=$path_scan.$tail#11
                  | |   | | +-quantifier=
                  | |   | | | +-GraphPathPatternQuantifier
                  | |   | | |   +-lower_bound=
                  | |   | | |   | +-Literal(type=INT64, value=1)
                  | |   | | |   +-upper_bound=
                  | |   | | |     +-Literal(type=INT64, value=1)
                  | |   | | +-group_variable_list=
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element1#4, array=$element_table.$element1#7)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.e2#5, array=$element_table.e2#8)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element2#6, array=$element_table.$element2#9)
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=[$path_scan.$head#18, $element_table.$element3#15, $element_table.$element4#17, $path_scan.$tail#19]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element3#12]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e3#13]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | | | +-orientation=ANY
                  | |   | | | +-GraphNodeScan
                  | |   | | |   +-column_list=[$element_table.$element4#14]
                  | |   | | |   +-label_expr=
                  | |   | | |   | +-GraphLabelNaryExpr
                  | |   | | |   |   +-op=OR
                  | |   | | |   |   +-operand_list=
                  | |   | | |   |     +-GraphWildCardLabel
                  | |   | | |   |     +-GraphLabelNaryExpr
                  | |   | | |   |       +-op=NOT
                  | |   | | |   |       +-operand_list=
                  | |   | | |   |         +-GraphWildCardLabel
                  | |   | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | +-head=$path_scan.$head#18
                  | |   | | +-tail=$path_scan.$tail#19
                  | |   | | +-quantifier=
                  | |   | | | +-GraphPathPatternQuantifier
                  | |   | | |   +-lower_bound=
                  | |   | | |   | +-Literal(type=INT64, value=1)
                  | |   | | |   +-upper_bound=
                  | |   | | |     +-Literal(type=INT64, value=1)
                  | |   | | +-group_variable_list=
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element3#12, array=$element_table.$element3#15)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.e3#13, array=$element_table.e3#16)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element4#14, array=$element_table.$element4#17)
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.b#20]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=AND
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |     | +-op=OR
                  | |   | | |     | +-operand_list=
                  | |   | | |     |   +-GraphWildCardLabel
                  | |   | | |     |   +-GraphLabelNaryExpr
                  | |   | | |     |     +-op=NOT
                  | |   | | |     |     +-operand_list=
                  | |   | | |     |       +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=OR
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | |         +-GraphLabelNaryExpr
                  | |   | | |           +-op=NOT
                  | |   | | |           +-operand_list=
                  | |   | | |             +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.e4#21]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.c#22]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-filter_expr=
                  | |   | +-FunctionCall(ZetaSQL:$equal(GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>) -> BOOL)
                  | |   |   +-ColumnRef(type=GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, column=$element_table.b#3)
                  | |   |   +-ColumnRef(type=GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, column=$element_table.b#20)
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.c#22
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=ACYCLIC)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#23]
                    +-expr_list=
                    | +-the_answer#23 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, e1#2, b#3, $element1#7, $element2#9, $element3#15, $element4#17, e4#21, c#22])
==

# TRAIL path modes with scalar edges that have different labels work.
select gt.* from
graph_table(aml
  MATCH TRAIL (a)-[e1]-(b)-[e2:Transfer]-(c)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#6 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#6]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#6]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#6]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#6]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[a#1, e1#2, b#3, e2#4, c#5]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[a#1, e1#2, b#3, e2#4, c#5]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.e1#2]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.b#3]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.e2#4]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabel(parse_location=64-72, label=aml.Transfer)
                  | |   | | +-target_element_table_list=[aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.c#5]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabelNaryExpr
                  | |   |   |   +-op=OR
                  | |   |   |   +-operand_list=
                  | |   |   |     +-GraphWildCardLabel
                  | |   |   |     +-GraphLabelNaryExpr
                  | |   |   |       +-op=NOT
                  | |   |   |       +-operand_list=
                  | |   |   |         +-GraphWildCardLabel
                  | |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.c#5
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#6]
                    +-expr_list=
                    | +-the_answer#6 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, e1#2, b#3, e2#4, c#5])
==

# ACYCLIC path modes with scalar nodes that have different labels work.
select gt.* from
graph_table(aml
  MATCH ACYCLIC (a:Person)-[e1]-(b)-[e2]-(c:Account)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#6 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#6]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#6]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#6]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#6]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$element_table.[a#1, e1#2, b#3, e2#4, c#5]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$element_table.[a#1, e1#2, b#3, e2#4, c#5]
                  | |   +-input_scan_list=
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.a#1]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabel(parse_location=52-58, label=aml.Person)
                  | |   | | +-target_element_table_list=[aml.Person]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.e1#2]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   | | +-column_list=[$element_table.b#3]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | +-GraphEdgeScan
                  | |   | | +-column_list=[$element_table.e2#4]
                  | |   | | +-label_expr=
                  | |   | | | +-GraphLabelNaryExpr
                  | |   | | |   +-op=OR
                  | |   | | |   +-operand_list=
                  | |   | | |     +-GraphWildCardLabel
                  | |   | | |     +-GraphLabelNaryExpr
                  | |   | | |       +-op=NOT
                  | |   | | |       +-operand_list=
                  | |   | | |         +-GraphWildCardLabel
                  | |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   | | +-orientation=ANY
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.c#5]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabel(parse_location=77-84, label=aml.Account)
                  | |   |   +-target_element_table_list=[aml.Account]
                  | |   +-head=$element_table.a#1
                  | |   +-tail=$element_table.c#5
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=ACYCLIC)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#6]
                    +-expr_list=
                    | +-the_answer#6 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#1, e1#2, b#3, e2#4, c#5])
==

# TRAIL path modes with quantified paths that themselves have nested paths work.
select gt.* from
graph_table(aml
  MATCH TRAIL ( ( (a)-[e1]->(b) where b.id > 0 )-[e2]->(c) ){1,2}
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#13 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#13]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#13]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#13]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#13]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$path_scan.$head#11, $element_table.e1#7, $element_table.e2#9, $path_scan.$tail#12]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$path_scan.$head#11, $element_table.e1#7, $element_table.e2#9, $path_scan.$tail#12]
                  | |   +-input_scan_list=
                  | |   | +-GraphPathScan
                  | |   |   +-column_list=[$path_scan.$head#11, $element_table.e1#7, $element_table.e2#9, $path_scan.$tail#12]
                  | |   |   +-input_scan_list=
                  | |   |   | +-GraphPathScan
                  | |   |   | | +-column_list=$element_table.[a#1, e1#2, b#3]
                  | |   |   | | +-input_scan_list=
                  | |   |   | | | +-GraphNodeScan
                  | |   |   | | | | +-column_list=[$element_table.a#1]
                  | |   |   | | | | +-label_expr=
                  | |   |   | | | | | +-GraphLabelNaryExpr
                  | |   |   | | | | |   +-op=OR
                  | |   |   | | | | |   +-operand_list=
                  | |   |   | | | | |     +-GraphWildCardLabel
                  | |   |   | | | | |     +-GraphLabelNaryExpr
                  | |   |   | | | | |       +-op=NOT
                  | |   |   | | | | |       +-operand_list=
                  | |   |   | | | | |         +-GraphWildCardLabel
                  | |   |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   | | | +-GraphEdgeScan
                  | |   |   | | | | +-column_list=[$element_table.e1#2]
                  | |   |   | | | | +-label_expr=
                  | |   |   | | | | | +-GraphLabelNaryExpr
                  | |   |   | | | | |   +-op=OR
                  | |   |   | | | | |   +-operand_list=
                  | |   |   | | | | |     +-GraphWildCardLabel
                  | |   |   | | | | |     +-GraphLabelNaryExpr
                  | |   |   | | | | |       +-op=NOT
                  | |   |   | | | | |       +-operand_list=
                  | |   |   | | | | |         +-GraphWildCardLabel
                  | |   |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   |   | | | | +-orientation=RIGHT
                  | |   |   | | | +-GraphNodeScan
                  | |   |   | | |   +-column_list=[$element_table.b#3]
                  | |   |   | | |   +-label_expr=
                  | |   |   | | |   | +-GraphLabelNaryExpr
                  | |   |   | | |   |   +-op=OR
                  | |   |   | | |   |   +-operand_list=
                  | |   |   | | |   |     +-GraphWildCardLabel
                  | |   |   | | |   |     +-GraphLabelNaryExpr
                  | |   |   | | |   |       +-op=NOT
                  | |   |   | | |   |       +-operand_list=
                  | |   |   | | |   |         +-GraphWildCardLabel
                  | |   |   | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   | | +-filter_expr=
                  | |   |   | | | +-FunctionCall(ZetaSQL:$greater(INT64, INT64) -> BOOL)
                  | |   |   | | |   +-GraphGetElementProperty
                  | |   |   | | |   | +-type=INT64
                  | |   |   | | |   | +-expr=
                  | |   |   | | |   | | +-ColumnRef(type=GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, column=$element_table.b#3)
                  | |   |   | | |   | +-property=id(INT64)
                  | |   |   | | |   +-Literal(type=INT64, value=0)
                  | |   |   | | +-head=$element_table.a#1
                  | |   |   | | +-tail=$element_table.b#3
                  | |   |   | +-GraphEdgeScan
                  | |   |   | | +-column_list=[$element_table.e2#4]
                  | |   |   | | +-label_expr=
                  | |   |   | | | +-GraphLabelNaryExpr
                  | |   |   | | |   +-op=OR
                  | |   |   | | |   +-operand_list=
                  | |   |   | | |     +-GraphWildCardLabel
                  | |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   | | |       +-op=NOT
                  | |   |   | | |       +-operand_list=
                  | |   |   | | |         +-GraphWildCardLabel
                  | |   |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   |   | | +-orientation=RIGHT
                  | |   |   | +-GraphNodeScan
                  | |   |   |   +-column_list=[$element_table.c#5]
                  | |   |   |   +-label_expr=
                  | |   |   |   | +-GraphLabelNaryExpr
                  | |   |   |   |   +-op=OR
                  | |   |   |   |   +-operand_list=
                  | |   |   |   |     +-GraphWildCardLabel
                  | |   |   |   |     +-GraphLabelNaryExpr
                  | |   |   |   |       +-op=NOT
                  | |   |   |   |       +-operand_list=
                  | |   |   |   |         +-GraphWildCardLabel
                  | |   |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   +-head=$path_scan.$head#11
                  | |   |   +-tail=$path_scan.$tail#12
                  | |   |   +-quantifier=
                  | |   |   | +-GraphPathPatternQuantifier
                  | |   |   |   +-lower_bound=
                  | |   |   |   | +-Literal(type=INT64, value=1)
                  | |   |   |   +-upper_bound=
                  | |   |   |     +-Literal(type=INT64, value=2)
                  | |   |   +-group_variable_list=
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.a#1, array=$element_table.a#6)
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.e1#2, array=$element_table.e1#7)
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.b#3, array=$element_table.b#8)
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.e2#4, array=$element_table.e2#9)
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.c#5, array=$element_table.c#10)
                  | |   +-head=$path_scan.$head#11
                  | |   +-tail=$path_scan.$tail#12
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#13]
                    +-expr_list=
                    | +-the_answer#13 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[e1#7, e2#9])
==

# Mixed scalar and array edge types are supported with path modes.
select gt.* from
graph_table(aml
  MATCH TRAIL ( ( (a)-[e1:Transfer]->(b) where b.id > 0 )-[e2]->(c) ){1,2}
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#13 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#13]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#13]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#13]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#13]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$path_scan.$head#11, $element_table.e1#7, $element_table.e2#9, $path_scan.$tail#12]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$path_scan.$head#11, $element_table.e1#7, $element_table.e2#9, $path_scan.$tail#12]
                  | |   +-input_scan_list=
                  | |   | +-GraphPathScan
                  | |   |   +-column_list=[$path_scan.$head#11, $element_table.e1#7, $element_table.e2#9, $path_scan.$tail#12]
                  | |   |   +-input_scan_list=
                  | |   |   | +-GraphPathScan
                  | |   |   | | +-column_list=$element_table.[a#1, e1#2, b#3]
                  | |   |   | | +-input_scan_list=
                  | |   |   | | | +-GraphNodeScan
                  | |   |   | | | | +-column_list=[$element_table.a#1]
                  | |   |   | | | | +-label_expr=
                  | |   |   | | | | | +-GraphLabelNaryExpr
                  | |   |   | | | | |   +-op=OR
                  | |   |   | | | | |   +-operand_list=
                  | |   |   | | | | |     +-GraphWildCardLabel
                  | |   |   | | | | |     +-GraphLabelNaryExpr
                  | |   |   | | | | |       +-op=NOT
                  | |   |   | | | | |       +-operand_list=
                  | |   |   | | | | |         +-GraphWildCardLabel
                  | |   |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   | | | +-GraphEdgeScan
                  | |   |   | | | | +-column_list=[$element_table.e1#2]
                  | |   |   | | | | +-label_expr=
                  | |   |   | | | | | +-GraphLabel(parse_location=59-67, label=aml.Transfer)
                  | |   |   | | | | +-target_element_table_list=[aml.Transfer]
                  | |   |   | | | | +-orientation=RIGHT
                  | |   |   | | | +-GraphNodeScan
                  | |   |   | | |   +-column_list=[$element_table.b#3]
                  | |   |   | | |   +-label_expr=
                  | |   |   | | |   | +-GraphLabelNaryExpr
                  | |   |   | | |   |   +-op=OR
                  | |   |   | | |   |   +-operand_list=
                  | |   |   | | |   |     +-GraphWildCardLabel
                  | |   |   | | |   |     +-GraphLabelNaryExpr
                  | |   |   | | |   |       +-op=NOT
                  | |   |   | | |   |       +-operand_list=
                  | |   |   | | |   |         +-GraphWildCardLabel
                  | |   |   | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   | | +-filter_expr=
                  | |   |   | | | +-FunctionCall(ZetaSQL:$greater(INT64, INT64) -> BOOL)
                  | |   |   | | |   +-GraphGetElementProperty
                  | |   |   | | |   | +-type=INT64
                  | |   |   | | |   | +-expr=
                  | |   |   | | |   | | +-ColumnRef(type=GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, column=$element_table.b#3)
                  | |   |   | | |   | +-property=id(INT64)
                  | |   |   | | |   +-Literal(type=INT64, value=0)
                  | |   |   | | +-head=$element_table.a#1
                  | |   |   | | +-tail=$element_table.b#3
                  | |   |   | +-GraphEdgeScan
                  | |   |   | | +-column_list=[$element_table.e2#4]
                  | |   |   | | +-label_expr=
                  | |   |   | | | +-GraphLabelNaryExpr
                  | |   |   | | |   +-op=OR
                  | |   |   | | |   +-operand_list=
                  | |   |   | | |     +-GraphWildCardLabel
                  | |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   | | |       +-op=NOT
                  | |   |   | | |       +-operand_list=
                  | |   |   | | |         +-GraphWildCardLabel
                  | |   |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   |   | | +-orientation=RIGHT
                  | |   |   | +-GraphNodeScan
                  | |   |   |   +-column_list=[$element_table.c#5]
                  | |   |   |   +-label_expr=
                  | |   |   |   | +-GraphLabelNaryExpr
                  | |   |   |   |   +-op=OR
                  | |   |   |   |   +-operand_list=
                  | |   |   |   |     +-GraphWildCardLabel
                  | |   |   |   |     +-GraphLabelNaryExpr
                  | |   |   |   |       +-op=NOT
                  | |   |   |   |       +-operand_list=
                  | |   |   |   |         +-GraphWildCardLabel
                  | |   |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   +-head=$path_scan.$head#11
                  | |   |   +-tail=$path_scan.$tail#12
                  | |   |   +-quantifier=
                  | |   |   | +-GraphPathPatternQuantifier
                  | |   |   |   +-lower_bound=
                  | |   |   |   | +-Literal(type=INT64, value=1)
                  | |   |   |   +-upper_bound=
                  | |   |   |     +-Literal(type=INT64, value=2)
                  | |   |   +-group_variable_list=
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.a#1, array=$element_table.a#6)
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.e1#2, array=$element_table.e1#7)
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.b#3, array=$element_table.b#8)
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.e2#4, array=$element_table.e2#9)
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.c#5, array=$element_table.c#10)
                  | |   +-head=$path_scan.$head#11
                  | |   +-tail=$path_scan.$tail#12
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#13]
                    +-expr_list=
                    | +-the_answer#13 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[e1#7, e2#9])
==

# Mixed scalar and array node types are supported with path modes.
select gt.* from
graph_table(aml
  MATCH ACYCLIC (((a:Person)-[e1]->(b) where b.id > 0)-[e2]->(c:Account)){1,2}
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#13 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#13]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#13]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#13]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#13]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$path_scan.$head#11, $element_table.a#6, $element_table.b#8, $element_table.c#10, $path_scan.$tail#12]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$path_scan.$head#11, $element_table.a#6, $element_table.b#8, $element_table.c#10, $path_scan.$tail#12]
                  | |   +-input_scan_list=
                  | |   | +-GraphPathScan
                  | |   |   +-column_list=[$path_scan.$head#11, $element_table.a#6, $element_table.b#8, $element_table.c#10, $path_scan.$tail#12]
                  | |   |   +-input_scan_list=
                  | |   |   | +-GraphPathScan
                  | |   |   | | +-column_list=$element_table.[a#1, e1#2, b#3]
                  | |   |   | | +-input_scan_list=
                  | |   |   | | | +-GraphNodeScan
                  | |   |   | | | | +-column_list=[$element_table.a#1]
                  | |   |   | | | | +-label_expr=
                  | |   |   | | | | | +-GraphLabel(parse_location=54-60, label=aml.Person)
                  | |   |   | | | | +-target_element_table_list=[aml.Person]
                  | |   |   | | | +-GraphEdgeScan
                  | |   |   | | | | +-column_list=[$element_table.e1#2]
                  | |   |   | | | | +-label_expr=
                  | |   |   | | | | | +-GraphLabelNaryExpr
                  | |   |   | | | | |   +-op=OR
                  | |   |   | | | | |   +-operand_list=
                  | |   |   | | | | |     +-GraphWildCardLabel
                  | |   |   | | | | |     +-GraphLabelNaryExpr
                  | |   |   | | | | |       +-op=NOT
                  | |   |   | | | | |       +-operand_list=
                  | |   |   | | | | |         +-GraphWildCardLabel
                  | |   |   | | | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   |   | | | | +-orientation=RIGHT
                  | |   |   | | | +-GraphNodeScan
                  | |   |   | | |   +-column_list=[$element_table.b#3]
                  | |   |   | | |   +-label_expr=
                  | |   |   | | |   | +-GraphLabelNaryExpr
                  | |   |   | | |   |   +-op=OR
                  | |   |   | | |   |   +-operand_list=
                  | |   |   | | |   |     +-GraphWildCardLabel
                  | |   |   | | |   |     +-GraphLabelNaryExpr
                  | |   |   | | |   |       +-op=NOT
                  | |   |   | | |   |       +-operand_list=
                  | |   |   | | |   |         +-GraphWildCardLabel
                  | |   |   | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   | | +-filter_expr=
                  | |   |   | | | +-FunctionCall(ZetaSQL:$greater(INT64, INT64) -> BOOL)
                  | |   |   | | |   +-GraphGetElementProperty
                  | |   |   | | |   | +-type=INT64
                  | |   |   | | |   | +-expr=
                  | |   |   | | |   | | +-ColumnRef(type=GRAPH_NODE(aml)<age UINT32, balance UINT64, birthday DATE, data BYTES, id INT64, name STRING, syndicateData ARRAY<INT64>, syndicateId INT64, syndicateName STRING>, column=$element_table.b#3)
                  | |   |   | | |   | +-property=id(INT64)
                  | |   |   | | |   +-Literal(type=INT64, value=0)
                  | |   |   | | +-head=$element_table.a#1
                  | |   |   | | +-tail=$element_table.b#3
                  | |   |   | +-GraphEdgeScan
                  | |   |   | | +-column_list=[$element_table.e2#4]
                  | |   |   | | +-label_expr=
                  | |   |   | | | +-GraphLabelNaryExpr
                  | |   |   | | |   +-op=OR
                  | |   |   | | |   +-operand_list=
                  | |   |   | | |     +-GraphWildCardLabel
                  | |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   | | |       +-op=NOT
                  | |   |   | | |       +-operand_list=
                  | |   |   | | |         +-GraphWildCardLabel
                  | |   |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   |   | | +-orientation=RIGHT
                  | |   |   | +-GraphNodeScan
                  | |   |   |   +-column_list=[$element_table.c#5]
                  | |   |   |   +-label_expr=
                  | |   |   |   | +-GraphLabel(parse_location=97-104, label=aml.Account)
                  | |   |   |   +-target_element_table_list=[aml.Account]
                  | |   |   +-head=$path_scan.$head#11
                  | |   |   +-tail=$path_scan.$tail#12
                  | |   |   +-quantifier=
                  | |   |   | +-GraphPathPatternQuantifier
                  | |   |   |   +-lower_bound=
                  | |   |   |   | +-Literal(type=INT64, value=1)
                  | |   |   |   +-upper_bound=
                  | |   |   |     +-Literal(type=INT64, value=2)
                  | |   |   +-group_variable_list=
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.a#1, array=$element_table.a#6)
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.e1#2, array=$element_table.e1#7)
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.b#3, array=$element_table.b#8)
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.e2#4, array=$element_table.e2#9)
                  | |   |     +-GraphMakeArrayVariable(element=$element_table.c#5, array=$element_table.c#10)
                  | |   +-head=$path_scan.$head#11
                  | |   +-tail=$path_scan.$tail#12
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=ACYCLIC)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#13]
                    +-expr_list=
                    | +-the_answer#13 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[a#6, b#8, c#10])
==

# ACYCLIC path mode works with quantified paths with 0 lower bound.
select gt.* from
graph_table(aml
  MATCH ACYCLIC -[e:PersonOwnAccount]->{0,1}(a:Account)
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#10 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#10]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#10]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#10]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#10]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=[$path_scan.$head#7, $element_table.$element1#4, $element_table.$element2#6, $path_scan.$tail#8, $element_table.a#9]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=[$path_scan.$head#7, $element_table.$element1#4, $element_table.$element2#6, $path_scan.$tail#8, $element_table.a#9]
                  | |   +-input_scan_list=
                  | |   | +-GraphPathScan
                  | |   | | +-column_list=[$path_scan.$head#7, $element_table.$element1#4, $element_table.$element2#6, $path_scan.$tail#8]
                  | |   | | +-input_scan_list=
                  | |   | | | +-GraphNodeScan
                  | |   | | | | +-column_list=[$element_table.$element1#1]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabelNaryExpr
                  | |   | | | | |   +-op=OR
                  | |   | | | | |   +-operand_list=
                  | |   | | | | |     +-GraphWildCardLabel
                  | |   | | | | |     +-GraphLabelNaryExpr
                  | |   | | | | |       +-op=NOT
                  | |   | | | | |       +-operand_list=
                  | |   | | | | |         +-GraphWildCardLabel
                  | |   | | | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | | +-GraphEdgeScan
                  | |   | | | | +-column_list=[$element_table.e#2]
                  | |   | | | | +-label_expr=
                  | |   | | | | | +-GraphLabel(parse_location=53-69, label=aml.PersonOwnAccount)
                  | |   | | | | +-target_element_table_list=[aml.PersonOwnAccount]
                  | |   | | | | +-orientation=RIGHT
                  | |   | | | +-GraphNodeScan
                  | |   | | |   +-column_list=[$element_table.$element2#3]
                  | |   | | |   +-label_expr=
                  | |   | | |   | +-GraphLabelNaryExpr
                  | |   | | |   |   +-op=OR
                  | |   | | |   |   +-operand_list=
                  | |   | | |   |     +-GraphWildCardLabel
                  | |   | | |   |     +-GraphLabelNaryExpr
                  | |   | | |   |       +-op=NOT
                  | |   | | |   |       +-operand_list=
                  | |   | | |   |         +-GraphWildCardLabel
                  | |   | | |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   | | +-head=$path_scan.$head#7
                  | |   | | +-tail=$path_scan.$tail#8
                  | |   | | +-quantifier=
                  | |   | | | +-GraphPathPatternQuantifier
                  | |   | | |   +-lower_bound=
                  | |   | | |   | +-Literal(type=INT64, value=0)
                  | |   | | |   +-upper_bound=
                  | |   | | |     +-Literal(type=INT64, value=1)
                  | |   | | +-group_variable_list=
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element1#1, array=$element_table.$element1#4)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.e#2, array=$element_table.e#5)
                  | |   | |   +-GraphMakeArrayVariable(element=$element_table.$element2#3, array=$element_table.$element2#6)
                  | |   | +-GraphNodeScan
                  | |   |   +-column_list=[$element_table.a#9]
                  | |   |   +-label_expr=
                  | |   |   | +-GraphLabel(parse_location=80-87, label=aml.Account)
                  | |   |   +-target_element_table_list=[aml.Account]
                  | |   +-head=$path_scan.$head#7
                  | |   +-tail=$element_table.a#9
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=ACYCLIC)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#10]
                    +-expr_list=
                    | +-the_answer#10 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan(column_list=$element_table.[$element1#4, $element2#6, a#9])
==

# No trail filter is generated for singular scalar variables on nested subpaths
# of quantified paths (b/353755038).
select gt.* from
graph_table(aml
  MATCH (TRAIL (TRAIL ->)){2}
  RETURN 42 as the_answer
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.the_answer#9 AS the_answer [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.the_answer#9]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.the_answer#9]
        +-property_graph=aml
        +-input_scan=
          +-GraphLinearScan
            +-column_list=[$graph_table.the_answer#9]
            +-scan_list=
              +-GraphLinearScan
                +-column_list=[$graph_table.the_answer#9]
                +-scan_list=
                  +-GraphScan
                  | +-column_list=$path_scan.[$head#7, $tail#8]
                  | +-input_scan_list=
                  | | +-GraphPathScan
                  | |   +-column_list=$path_scan.[$head#7, $tail#8]
                  | |   +-input_scan_list=
                  | |   | +-GraphPathScan
                  | |   |   +-column_list=$element_table.[$element1#1, $element2#2, $element3#3]
                  | |   |   +-input_scan_list=
                  | |   |   | +-GraphNodeScan
                  | |   |   | | +-column_list=[$element_table.$element1#1]
                  | |   |   | | +-label_expr=
                  | |   |   | | | +-GraphLabelNaryExpr
                  | |   |   | | |   +-op=OR
                  | |   |   | | |   +-operand_list=
                  | |   |   | | |     +-GraphWildCardLabel
                  | |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   | | |       +-op=NOT
                  | |   |   | | |       +-operand_list=
                  | |   |   | | |         +-GraphWildCardLabel
                  | |   |   | | +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   | +-GraphEdgeScan
                  | |   |   | | +-column_list=[$element_table.$element2#2]
                  | |   |   | | +-label_expr=
                  | |   |   | | | +-GraphLabelNaryExpr
                  | |   |   | | |   +-op=OR
                  | |   |   | | |   +-operand_list=
                  | |   |   | | |     +-GraphWildCardLabel
                  | |   |   | | |     +-GraphLabelNaryExpr
                  | |   |   | | |       +-op=NOT
                  | |   |   | | |       +-operand_list=
                  | |   |   | | |         +-GraphWildCardLabel
                  | |   |   | | +-target_element_table_list=[aml.PersonOwnAccount,aml.Transfer]
                  | |   |   | | +-orientation=RIGHT
                  | |   |   | +-GraphNodeScan
                  | |   |   |   +-column_list=[$element_table.$element3#3]
                  | |   |   |   +-label_expr=
                  | |   |   |   | +-GraphLabelNaryExpr
                  | |   |   |   |   +-op=OR
                  | |   |   |   |   +-operand_list=
                  | |   |   |   |     +-GraphWildCardLabel
                  | |   |   |   |     +-GraphLabelNaryExpr
                  | |   |   |   |       +-op=NOT
                  | |   |   |   |       +-operand_list=
                  | |   |   |   |         +-GraphWildCardLabel
                  | |   |   |   +-target_element_table_list=[aml.Account,aml.Person,aml.Syndicate]
                  | |   |   +-head=$element_table.$element1#1
                  | |   |   +-tail=$element_table.$element3#3
                  | |   |   +-path_mode=
                  | |   |     +-GraphPathMode(path_mode=TRAIL)
                  | |   +-head=$path_scan.$head#7
                  | |   +-tail=$path_scan.$tail#8
                  | |   +-quantifier=
                  | |   | +-GraphPathPatternQuantifier
                  | |   |   +-lower_bound=
                  | |   |   | +-Literal(type=INT64, value=2)
                  | |   |   +-upper_bound=
                  | |   |     +-Literal(type=INT64, value=2)
                  | |   +-group_variable_list=
                  | |   | +-GraphMakeArrayVariable(element=$element_table.$element1#1, array=$element_table.$element1#4)
                  | |   | +-GraphMakeArrayVariable(element=$element_table.$element2#2, array=$element_table.$element2#5)
                  | |   | +-GraphMakeArrayVariable(element=$element_table.$element3#3, array=$element_table.$element3#6)
                  | |   +-path_mode=
                  | |     +-GraphPathMode(path_mode=TRAIL)
                  | +-input_scan=
                  |   +-SingleRowScan
                  +-ProjectScan
                    +-column_list=[$graph_table.the_answer#9]
                    +-expr_list=
                    | +-the_answer#9 := Literal(type=INT64, value=42)
                    +-input_scan=
                      +-GraphRefScan
==

###
### Feature is disabled without path mode feature flag.
###
[language_features=NONE,+SQL_GRAPH,+SQL_GRAPH_ADVANCED_QUERY,+SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION]

select gt.* from
graph_table(aml
  MATCH {{TRAIL|WALK|SIMPLE|ACYCLIC}} (a)-(b)-(c)
  RETURN 42 as the_answer
) gt
--
ALTERNATION GROUP: TRAIL
--
ERROR: path mode is not supported [at 3:9]
  MATCH TRAIL (a)-(b)-(c)
        ^
--
ALTERNATION GROUP: WALK
--
ERROR: path mode is not supported [at 3:9]
  MATCH WALK (a)-(b)-(c)
        ^
--
ALTERNATION GROUP: SIMPLE
--
ERROR: path mode is not supported [at 3:9]
  MATCH SIMPLE (a)-(b)-(c)
        ^
--
ALTERNATION GROUP: ACYCLIC
--
ERROR: path mode is not supported [at 3:9]
  MATCH ACYCLIC (a)-(b)-(c)
        ^

==

# Path search and path mode should not co-exist
SELECT one FROM GRAPH_TABLE(
  aml
  MATCH ANY SHORTEST TRAIL -[b]->
  COLUMNS(1 AS one)
)
--
ERROR: Path pattern with path mode and search prefix is not allowed [at 3:9]
  MATCH ANY SHORTEST TRAIL -[b]->
        ^

